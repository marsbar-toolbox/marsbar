<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of mars_rois2img</title>
  <meta name="keywords" content="mars_rois2img">
  <meta name="description" content="creates cluster or number labelled ROI image from ROIs">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">marsbar</a> &gt; mars_rois2img.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for marsbar&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>mars_rois2img
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>creates cluster or number labelled ROI image from ROIs</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function mars_rois2img(roi_list, img_name, roi_space, flags) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> creates cluster or number labelled ROI image from ROIs
 FORMAT mars_rois2img(roi_list, img_name, roi_space, flags)

 roi_list  - strings with ROI filenames
 img_name  - name of image to write out
 roi_space - space for image
 flags    - none or more of: [default = 'i']
             'i' - id image, voxel values identify ROIs
             'c' - cluster image, clusters identified by location

 $Id %
</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>	overloaded isempty method for mardo object</li>
<li><a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>	label - returns / sets label value for object</li>
<li><a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>	maroi - class constructor for umbrella ROI object</li>
<li><a href="../marsbar/@maroi/maroi_matrix.html" class="code" title="function obj2 = maroi_matrix(obj, sp)">maroi_matrix</a>	maroi_matrix method - converts roi to maroi matrix type</li>
<li><a href="../marsbar/@maroi_box/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	returns 1 if ROI contains no volume</li>
<li><a href="../marsbar/@maroi_image/maroi_matrix.html" class="code" title="function o = maroi_matrix(o, sp)">maroi_matrix</a>	maroi_matrix method - converts maroi_image to maroi_matrix</li>
<li><a href="../marsbar/@maroi_matrix/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	is_empty_roi - returns true if ROI contains no volume</li>
<li><a href="../marsbar/@maroi_matrix/maroi_matrix.html" class="code" title="function [o, others] = maroi_matrix(params, space)">maroi_matrix</a>	maroi_matrix - class constructor</li>
<li><a href="../marsbar/@maroi_matrix/matrixdata.html" class="code" title="function dat = matrixdata(o, dat)">matrixdata</a>	matrixdata method - gets matrix from ROI object</li>
<li><a href="../marsbar/@maroi_pointlist/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	is_empty_roi - returns true if ROI contains no volume</li>
<li><a href="../marsbar/@maroi_pointlist/maroi_matrix.html" class="code" title="function obj2 = maroi_matrix(obj, space)">maroi_matrix</a>	maroi_matrix method - converts roi to maroi matrix type</li>
<li><a href="../marsbar/@maroi_shape/maroi_matrix.html" class="code" title="function o2 = maroi_matrix(o, space)">maroi_matrix</a>	method to convert shape objects to maroi_matrix objects</li>
<li><a href="../marsbar/@maroi_sphere/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	is_empty_roi - returns true if ROI contains no volume</li>
<li><a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>	collection of useful utility functions for MarsBaR etc</li>
<li><a href="mars_vol_utils.html" class="code" title="function varargout=mars_vol_utils(varargin)">mars_vol_utils</a>	collection of useful utility functions for vol structs</li>
<li><a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>	compatibility function to allow spm_get calls with SPM5</li>
<li><a href="../marsbar/spm99/spm_create_vol.html" class="code" title="function V = spm_create_vol(V)">spm_create_vol</a>	Wrapper for spm_create_image, for compatibility with SPM2</li>
<li><a href="../marsbar/spm99/spm_write_vol.html" class="code" title="function V = spm_write_vol(V,Y)">spm_write_vol</a>	Write an image volume to disk, setting scales and offsets as appropriate</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>	Startup, callback and utility routine for Marsbar</li>
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function mars_rois2img(roi_list, img_name, roi_space, flags)</a>
0002 <span class="comment">% creates cluster or number labelled ROI image from ROIs</span>
0003 <span class="comment">% FORMAT mars_rois2img(roi_list, img_name, roi_space, flags)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% roi_list  - strings with ROI filenames</span>
0006 <span class="comment">% img_name  - name of image to write out</span>
0007 <span class="comment">% roi_space - space for image</span>
0008 <span class="comment">% flags    - none or more of: [default = 'i']</span>
0009 <span class="comment">%             'i' - id image, voxel values identify ROIs</span>
0010 <span class="comment">%             'c' - cluster image, clusters identified by location</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% $Id %</span>
0013   
0014 <span class="keyword">if</span> nargin &lt; 1
0015   roi_list = <span class="string">''</span>;
0016 <span class="keyword">end</span>
0017 <span class="keyword">if</span> nargin &lt; 2
0018   img_name = <span class="string">''</span>;
0019 <span class="keyword">end</span>
0020 <span class="keyword">if</span> nargin &lt; 3
0021   roi_space = [];
0022 <span class="keyword">end</span>
0023 <span class="keyword">if</span> nargin &lt; 4
0024   flags = <span class="string">''</span>;
0025 <span class="keyword">end</span>
0026 
0027 <span class="comment">% Process input arguments</span>
0028 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi_list)
0029   roi_list = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 Inf], [<span class="string">'*'</span> <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'fileend'</span>)], <span class="keyword">...</span>
0030              <span class="string">'Select ROIs to write to image'</span>);
0031   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi_list), <span class="keyword">return</span>, <span class="keyword">end</span>
0032 <span class="keyword">end</span>
0033 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(img_name)
0034   img_name = <a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>(<span class="string">'get_img_name'</span>);
0035   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(img_name), <span class="keyword">return</span>, <span class="keyword">end</span>
0036 <span class="keyword">end</span>
0037 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi_space)
0038    roi_space = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'spacebase'</span>);
0039 <span class="keyword">end</span>
0040 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(flags)
0041   flags = <span class="string">'i'</span>;  <span class="comment">% id image is default</span>
0042 <span class="keyword">end</span>
0043 
0044 roi_list = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'load_cell'</span>, roi_list);
0045 roi_len = prod(size(roi_list));
0046 
0047 img_data = zeros(roi_space.dim);
0048 roi_ctr = 1;
0049 <span class="keyword">for</span> i = 1:roi_len
0050   roi = roi_list{i};
0051   <span class="comment">% check ROI contains something</span>
0052   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi) 
0053     warning(sprintf(<span class="string">'ROI %d is missing'</span>, i));
0054   <span class="keyword">elseif</span> <a href="../marsbar/@maroi_box/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>(roi)
0055     warning(sprintf(<span class="string">'ROI %d:%s is empty'</span>, i, <a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>(roi)));
0056   <span class="keyword">else</span>    
0057     <span class="comment">% convert ROI to matrix</span>
0058     mo = <a href="../marsbar/@maroi/maroi_matrix.html" class="code" title="function obj2 = maroi_matrix(obj, sp)">maroi_matrix</a>(roi, roi_space);
0059     dat = <a href="../marsbar/@maroi_matrix/matrixdata.html" class="code" title="function dat = matrixdata(o, dat)">matrixdata</a>(mo);
0060     <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(dat) | ~any(dat(:))
0061       warning(sprintf(<span class="string">'ROI %d: %s  - contains no points in this space'</span>,<span class="keyword">...</span>
0062               i, <a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>(roi)));
0063     <span class="keyword">else</span>
0064       <span class="comment">% add matrix to image</span>
0065       <span class="keyword">if</span> any(flags == <span class="string">'i'</span>)
0066     img_data(dat ~= 0) = roi_ctr;
0067     roi_info(roi_ctr) = struct(<span class="string">'label'</span>, <a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>(roi),<span class="keyword">...</span>
0068                    <span class="string">'number'</span>, roi_ctr);
0069       <span class="keyword">else</span>
0070     img_data = img_data + dat;
0071       <span class="keyword">end</span>
0072       roi_ctr = roi_ctr + 1;
0073     <span class="keyword">end</span>
0074   <span class="keyword">end</span>
0075 <span class="keyword">end</span>
0076 <span class="keyword">if</span> roi_ctr == 1
0077   warning(<span class="string">'Found no useful ROIs, no image saved'</span>);
0078   <span class="keyword">return</span>
0079 <span class="keyword">end</span>
0080 
0081 <span class="comment">% output image type</span>
0082 img_type = <span class="string">'float'</span>; <span class="comment">% to avoid rounding errors</span>
0083 
0084 <span class="comment">% save ROI info</span>
0085 <span class="keyword">if</span> any(flags == <span class="string">'i'</span>)
0086   [p f e] = fileparts(img_name);
0087   iname = fullfile(p, [f <span class="string">'_labels.mat'</span>]);
0088   save(iname, <span class="string">'roi_info'</span>);
0089 <span class="keyword">end</span>
0090 
0091 <span class="comment">% Prepare and write image</span>
0092 V = <a href="mars_vol_utils.html" class="code" title="function varargout=mars_vol_utils(varargin)">mars_vol_utils</a>(<span class="string">'def_vol'</span>);
0093 V.fname = img_name;
0094 V.mat = roi_space.mat;
0095 V.dim(1:3) = roi_space.dim;
0096 V = <a href="mars_vol_utils.html" class="code" title="function varargout=mars_vol_utils(varargin)">mars_vol_utils</a>(<span class="string">'set_type'</span>, V, img_type);
0097 
0098 V = <a href="../marsbar/spm99/spm_create_vol.html" class="code" title="function V = spm_create_vol(V)">spm_create_vol</a>(V);
0099 V = <a href="../marsbar/spm99/spm_write_vol.html" class="code" title="function V = spm_write_vol(V,Y)">spm_write_vol</a>(V, img_data);
0100 
0101 fprintf(<span class="string">'Wrote image %s\nDone...\n'</span>, img_name);
</pre></div>

<hr><address>Generated on Tue 01-Jun-2021 17:03:02 by <strong><a href="https://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003-2019</address>
</body>
</html>
