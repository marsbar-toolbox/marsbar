<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of marsbar</title>
  <meta name="keywords" content="marsbar">
  <meta name="description" content="Startup, callback and utility routine for Marsbar">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">marsbar</a> &gt; marsbar.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for marsbar&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>marsbar
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Startup, callback and utility routine for Marsbar</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout=marsbar(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Startup, callback and utility routine for Marsbar

 MarsBaR: Marseille Boite a Regions d'interet 
          Marseille Region of Interest Toolbox 

 MarsBaR (the collection of files listed by contents.m) is copyright under
 the GNU general public license.  Please see mars_licence.man for details.
 
 Marsbar written and copyright claimed by 
 Jean-Luc Anton, Matthew Brett, Jean-Baptiste Poline, Romain Valabregue 

 Portions of the code rely heavily on (or are copied from) SPM
 (http://www.fil.ion.ucl.ac.uk/spm), which is also released under the GNU
 public licence.  Many thanks the SPM authors: (John Ashburner, Karl Friston,
 Andrew Holmes et al, and of course our own Jean-Baptiste).

 This software is MarsBaRWare. It is written in the hope that it is
 helpful; if you find it so, please let us know by sending a Mars bar to:
 The Jean-Luc confectionery collection, Centre IRMf, CHU La Timone, 264,
 Rue Saint Pierre 13385 Marseille Cedex 05, France
 
 If you find that it actively hinders your work, do send an
 elderly sardine to the same address.

 Please visit our friends at The Visible Mars Bar project:
 http://totl.net/VisibleMars

 $Id$
</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../marsbar/@mardo/add_contrasts.html" class="code" title="function [D,Ic,changef] = add_contrasts(D, C, varargin)">add_contrasts</a>	method to add contrast definitions to design</li>
<li><a href="../marsbar/@mardo/cd_images.html" class="code" title="function D = cd_images(D, newpath, byteswap)">cd_images</a>	method for changing path to image files in design</li>
<li><a href="../marsbar/@mardo/descrip.html" class="code" title="function strs = descrip(D)">descrip</a>	method gets cell string description of design</li>
<li><a href="../marsbar/@mardo/event_fitted.html" class="code" title="function [tc, dt] = event_fitted(D, e_spec, dur)">event_fitted</a>	method to compute fitted event time course</li>
<li><a href="../marsbar/@mardo/event_fitted_fir.html" class="code" title="function [tc, dt] = event_fitted_fir(D, e_spec, bin_length, bin_no, opts)">event_fitted_fir</a>	method to compute fitted event time courses using FIR</li>
<li><a href="../marsbar/@mardo/event_signal.html" class="code" title="function s = event_signal(D, e_spec, dur, diff_func, varargin)">event_signal</a>	method to compute % signal change from fMRI events</li>
<li><a href="../marsbar/@mardo/event_types.html" class="code" title="function res = event_types(D, et)">event_types</a>	method to get / set event types for design</li>
<li><a href="../marsbar/@mardo/event_types_named.html" class="code" title="function et = event_types_named(D)">event_types_named</a>	method returns event types structures for events with same names</li>
<li><a href="../marsbar/@mardo/get_contrasts.html" class="code" title="function xCon = get_contrasts(D)">get_contrasts</a>	method to get contrasts from design object</li>
<li><a href="../marsbar/@mardo/get_data.html" class="code" title="function d = get_data(D)">get_data</a>	method to get data from design object</li>
<li><a href="../marsbar/@mardo/has_contrasts.html" class="code" title="function tf = has_contrasts(D)">has_contrasts</a>	method returns 1 if design has contrasts</li>
<li><a href="../marsbar/@mardo/has_filter.html" class="code" title="function tf = has_filter(o)">has_filter</a>	returns 1 if object contains filter</li>
<li><a href="../marsbar/@mardo/has_images.html" class="code" title="function tf = has_images(o)">has_images</a>	returns 1 if design contains images, NaN if not known</li>
<li><a href="../marsbar/@mardo/has_whitener.html" class="code" title="function tf = has_whitener(D)">has_whitener</a>	returns 1 if design has whitening filter</li>
<li><a href="../marsbar/@mardo/image_names.html" class="code" title="function P = image_names(D)">image_names</a>	method returning image file names for design</li>
<li><a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>	method returns 1 if this is an fmri design</li>
<li><a href="../marsbar/@mardo/is_valid.html" class="code" title="function tf = is_valid(o)">is_valid</a>	returns 1 if object contains valid SPM/MarsBaR design</li>
<li><a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>	overloaded isempty method for mardo object</li>
<li><a href="../marsbar/@mardo/isfield.html" class="code" title="function result = isfield(this, fieldn)">isfield</a>	method to overload isfield for mardo objects</li>
<li><a href="../marsbar/@mardo/mardo.html" class="code" title="function [o, others] = mardo(params, others, passf)">mardo</a>	mardo - class constructor for MarsBaR design object</li>
<li><a href="../marsbar/@mardo/prefix_images.html" class="code" title="function D = prefix_images(D, action, prefix, flags)">prefix_images</a>	method for adding or removing prefix from file names in design</li>
<li><a href="../marsbar/@mardo/refresh_contrasts.html" class="code" title="function o = refresh_contrasts(o)">refresh_contrasts</a>	method to refresh contrasts to match design</li>
<li><a href="../marsbar/@mardo/residuals.html" class="code" title="function r = residuals(D)">residuals</a>	method returns residuals from model</li>
<li><a href="../marsbar/@mardo/savestruct.html" class="code" title="function savestruct(obj, filename)">savestruct</a>	saves data in def_struct as variables in .mat file</li>
<li><a href="../marsbar/@mardo/stat_table.html" class="code" title="function [rep_strs, marsS, marsD, changef] = stat_table(marsD, Ic)">stat_table</a>	gets Mars statistics and creates statistic table as cell array</li>
<li><a href="../marsbar/@mardo/type.html" class="code" title="function str = type(o)">type</a>	returns SPM version string corresponding to design type</li>
<li><a href="../marsbar/@mardo/ui_event_types.html" class="code" title="function [D, ic, status] = ui_event_types(D)">ui_event_types</a>	ui method for selection / editing of event types</li>
<li><a href="../marsbar/@mardo/ui_ft_design_data.html" class="code" title="function ui_ft_design_data(D, mY, e_s, opts)">ui_ft_design_data</a>	method plots FT of design and data to graphics window</li>
<li><a href="../marsbar/@mardo/ui_get_contrasts.html" class="code" title="function varargout=ui_get_contrasts(D, varargin)">ui_get_contrasts</a>	SPM contrast UI, wrapped for MarsBaR</li>
<li><a href="../marsbar/@mardo_2/add_trial_f.html" class="code" title="function [D, changef] = add_trial_f(D)">add_trial_f</a>	method to add trial-specific F contrasts</li>
<li><a href="../marsbar/@mardo_2/apply_filter.html" class="code" title="function Y = apply_filter(D, Y, flags)">apply_filter</a>	applies filter in design to data</li>
<li><a href="../marsbar/@mardo_2/bf_dt.html" class="code" title="function d = bf_dt(D)">bf_dt</a>	method returns length of time bin for basis functions</li>
<li><a href="../marsbar/@mardo_2/block_rows.html" class="code" title="function rows = block_rows(D)">block_rows</a>	returns cell array of rows for each (subject/session) block</li>
<li><a href="../marsbar/@mardo_2/can_mars_estimate.html" class="code" title="function tf = can_mars_estimate(D)">can_mars_estimate</a>	method returns 1 if design can be estimated in MarsBaR</li>
<li><a href="../marsbar/@mardo_2/estimate.html" class="code" title="function [marsD] = estimate(marsD, marsY, params)">estimate</a>	estimate method - estimates GLM for SPM2 model</li>
<li><a href="../marsbar/@mardo_2/event_onsets.html" class="code" title="function [onsets, durations] = event_onsets(D, e_spec)">event_onsets</a>	method gets onsets and durations for event/session</li>
<li><a href="../marsbar/@mardo_2/fill.html" class="code" title="function D = fill(D, actions)">fill</a>	fills missing entries from SPM FMRI design matrix</li>
<li><a href="../marsbar/@mardo_2/has_filter.html" class="code" title="function tf = has_filter(o)">has_filter</a>	returns 1 if object contains filter</li>
<li><a href="../marsbar/@mardo_2/has_images.html" class="code" title="function tf = has_images(o)">has_images</a>	returns 1 if design contains images</li>
<li><a href="../marsbar/@mardo_2/has_whitener.html" class="code" title="function tf = has_whitener(D)">has_whitener</a>	returns 1 if design has whitening filter</li>
<li><a href="../marsbar/@mardo_2/mars_spm_graph.html" class="code" title="function [r_st,marsD,changef] = mars_spm_graph(marsD,rno,Ic)">mars_spm_graph</a>	Graphical display of adjusted data</li>
<li><a href="../marsbar/@mardo_2/savestruct.html" class="code" title="function savestruct(obj, filename)">savestruct</a>	saves data in def_struct into .mat file with variable name SPM</li>
<li><a href="../marsbar/@mardo_2/tr.html" class="code" title="function t = tr(o)">tr</a>	method returns TR in seconds, or empty if not available</li>
<li><a href="../marsbar/@mardo_2/type.html" class="code" title="function str = type(o)">type</a>	returns SPM version string corresponding to design type</li>
<li><a href="../marsbar/@mardo_2/ui_build.html" class="code" title="function D = ui_build(D, dtype)">ui_build</a>	method to create / fill design via GUI</li>
<li><a href="../marsbar/@mardo_2/ui_report.html" class="code" title="function varargout = ui_report(D, varargin)">ui_report</a>	method for SPM2 design reporting</li>
<li><a href="../marsbar/@mardo_5/estimate.html" class="code" title="function [marsD] = estimate(marsD, marsY, params)">estimate</a>	estimate method - estimates GLM for SPM2 model</li>
<li><a href="../marsbar/@mardo_5/fill.html" class="code" title="function D = fill(D, actions)">fill</a>	fills missing entries from SPM FMRI design matrix</li>
<li><a href="../marsbar/@mardo_5/type.html" class="code" title="function str = type(o)">type</a>	returns SPM version string corresponding to design type</li>
<li><a href="../marsbar/@mardo_5/ui_build.html" class="code" title="function D = ui_build(D, dtype)">ui_build</a>	method to create / fill design via GUI</li>
<li><a href="../marsbar/@mardo_99/add_trial_f.html" class="code" title="function [D, changef] = add_trial_f(D)">add_trial_f</a>	method to add trial-specific F contrasts</li>
<li><a href="../marsbar/@mardo_99/apply_filter.html" class="code" title="function Y = apply_filter(D, Y, flags)">apply_filter</a>	applies filter in design to data</li>
<li><a href="../marsbar/@mardo_99/bf_dt.html" class="code" title="function d = bf_dt(D)">bf_dt</a>	method returns length of time bin for basis functions</li>
<li><a href="../marsbar/@mardo_99/block_rows.html" class="code" title="function rows = block_rows(D)">block_rows</a>	returns cell array of rows for each (subject/session) block</li>
<li><a href="../marsbar/@mardo_99/can_mars_estimate.html" class="code" title="function tf = can_mars_estimate(D)">can_mars_estimate</a>	method returns 1 if design can be estimated in MarsBaR</li>
<li><a href="../marsbar/@mardo_99/estimate.html" class="code" title="function [marsD] = estimate(marsD, marsY, params)">estimate</a>	estimate method - estimates GLM for SPM99 model</li>
<li><a href="../marsbar/@mardo_99/event_onsets.html" class="code" title="function [onsets, durations] = event_onsets(D, e_spec)">event_onsets</a>	method gets (estimated) onsets and durations for event/session</li>
<li><a href="../marsbar/@mardo_99/fill.html" class="code" title="function D = fill(D, actions)">fill</a>	fills missing entries from SPM FMRI design matrix</li>
<li><a href="../marsbar/@mardo_99/has_filter.html" class="code" title="function tf = has_filter(o)">has_filter</a>	returns 1 if object contains filter</li>
<li><a href="../marsbar/@mardo_99/has_images.html" class="code" title="function tf = has_images(o)">has_images</a>	returns 1 if design contains images</li>
<li><a href="../marsbar/@mardo_99/mars_spm_graph.html" class="code" title="function [r_st,marsD,changef] = mars_spm_graph(marsD,rno,Ic)">mars_spm_graph</a>	Graphical display of adjusted data</li>
<li><a href="../marsbar/@mardo_99/tr.html" class="code" title="function t = tr(o)">tr</a>	method returns TR in seconds, or empty if not available</li>
<li><a href="../marsbar/@mardo_99/type.html" class="code" title="function str = type(o)">type</a>	returns SPM version string corresponding to design type</li>
<li><a href="../marsbar/@mardo_99/ui_build.html" class="code" title="function D = ui_build(D, dtype)">ui_build</a>	method to create / fill design via GUI</li>
<li><a href="../marsbar/@mardo_99/ui_report.html" class="code" title="function varargout = ui_report(D, varargin)">ui_report</a>	mathod for SPM99 design reporting</li>
<li><a href="../marsbar/@marmoire/add_if_absent.html" class="code" title="function o = add_if_absent(o, item, data)">add_if_absent</a>	Adds item only if not already present</li>
<li><a href="../marsbar/@marmoire/marmoire.html" class="code" title="function [o, others] = marmoire(params, varargin)">marmoire</a>	marmoire - class constructor for marmoire container type</li>
<li><a href="../marsbar/@maroi/descrip.html" class="code" title="function h = descrip(obj, val)">descrip</a>	name - returns / sets name value for object</li>
<li><a href="../marsbar/@maroi/flip_lr.html" class="code" title="function o = flip_lr(o)">flip_lr</a>	flips ROI left / right</li>
<li><a href="../marsbar/@maroi/get_marsy.html" class="code" title="function marsY = get_marsy(varargin)">get_marsy</a>	gets data in ROIs from images</li>
<li><a href="../marsbar/@maroi/has_space.html" class="code" title="function tf = has_space(obj)">has_space</a>	has_space method - returns true if object has a native space</li>
<li><a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>	label - returns / sets label value for object</li>
<li><a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>	maroi - class constructor for umbrella ROI object</li>
<li><a href="../marsbar/@maroi/save_as_image.html" class="code" title="function v = save_as_image(o, fname, sp)">save_as_image</a>	method save_as_image - saves ROI as image</li>
<li><a href="../marsbar/@maroi/saveroi.html" class="code" title="function roi = saveroi(roi, fname)">saveroi</a>	saveroi method - checks fname, sets source field, saves object</li>
<li><a href="../marsbar/@maroi/source.html" class="code" title="function h = source(obj, val)">source</a>	source - returns / sets source value for object</li>
<li><a href="../marsbar/@maroi/times.html" class="code" title="function o = times(o1, o2)">times</a>	overloaded times function</li>
<li><a href="../marsbar/@maroi/volume.html" class="code" title="function v = volume(obj)">volume</a>	volume method - returns volume of ROI in mm</li>
<li><a href="../marsbar/@maroi_box/flip_lr.html" class="code" title="function o = flip_lr(o)">flip_lr</a>	flips ROI left / right</li>
<li><a href="../marsbar/@maroi_box/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	returns 1 if ROI contains no volume</li>
<li><a href="../marsbar/@maroi_box/volume.html" class="code" title="function v = volume(obj)">volume</a>	volume method - returns volume of ROI in mm</li>
<li><a href="../marsbar/@maroi_image/flip_lr.html" class="code" title="function o = flip_lr(o)">flip_lr</a>	flips ROI left / right</li>
<li><a href="../marsbar/@maroi_image/vol.html" class="code" title="function h = vol(obj, val)">vol</a>	vol - returns / sets image vol for object</li>
<li><a href="../marsbar/@maroi_matrix/flip_lr.html" class="code" title="function o = flip_lr(o)">flip_lr</a>	flips ROI left / right</li>
<li><a href="../marsbar/@maroi_matrix/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	is_empty_roi - returns true if ROI contains no volume</li>
<li><a href="../marsbar/@maroi_pointlist/flip_lr.html" class="code" title="function o = flip_lr(o)">flip_lr</a>	flips ROI left / right</li>
<li><a href="../marsbar/@maroi_pointlist/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	is_empty_roi - returns true if ROI contains no volume</li>
<li><a href="../marsbar/@maroi_shape/has_space.html" class="code" title="function tf = has_space(obj)">has_space</a>	has_space method - returns true if object has a native space</li>
<li><a href="../marsbar/@maroi_sphere/flip_lr.html" class="code" title="function o = flip_lr(o)">flip_lr</a>	flips ROI left / right</li>
<li><a href="../marsbar/@maroi_sphere/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>	is_empty_roi - returns true if ROI contains no volume</li>
<li><a href="../marsbar/@maroi_sphere/volume.html" class="code" title="function v = volume(obj)">volume</a>	volume method - returns volume of ROI in mm</li>
<li><a href="../marsbar/@mars_space/mars_space.html" class="code" title="function [o, others] = mars_space(params, params2)">mars_space</a>	mars_space - class constructor for space defining object</li>
<li><a href="../marsbar/@marsy/block_rows.html" class="code" title="function r = block_rows(Y, rows)">block_rows</a>	gets/sets cell array of rows for each (subject/session) block</li>
<li><a href="../marsbar/@marsy/is_valid.html" class="code" title="function tf = is_valid(o)">is_valid</a>	method returns 1 if object contains valid data</li>
<li><a href="../marsbar/@marsy/join.html" class="code" title="function o = join(varargin)">join</a>	joins marsy objects into one object</li>
<li><a href="../marsbar/@marsy/marsy.html" class="code" title="function [o,others] = marsy(params, region_stuff, summary_stuff)">marsy</a>	Class constructor for marsy: the MarsBaR data object</li>
<li><a href="../marsbar/@marsy/n_regions.html" class="code" title="function n = n_regions(o)">n_regions</a>	get number of regions</li>
<li><a href="../marsbar/@marsy/region_data.html" class="code" title="function res = region_data(varargin)">region_data</a>	method gets or sets data for region(s) as cell array</li>
<li><a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>	method gets or sets data for region name</li>
<li><a href="../marsbar/@marsy/savestruct.html" class="code" title="function savestruct(obj, filename)">savestruct</a>	saves data in y_struct as variables in .mat file</li>
<li><a href="../marsbar/@marsy/split.html" class="code" title="function o_arr = split(o)">split</a>	method splits regions in object into separate objects</li>
<li><a href="../marsbar/@marsy/sumfunc.html" class="code" title="function o = sumfunc(o, sumfunc)">sumfunc</a>	method to get or set sumfunc</li>
<li><a href="../marsbar/@marsy/summary_data.html" class="code" title="function [Y,Yvar,o] = summary_data(o, sumfunc_str)">summary_data</a>	method to get summary data, maybe set sumfunc</li>
<li><a href="../marsbar/@marsy/summary_descrip.html" class="code" title="function res = summary_descrip(o, descrip)">summary_descrip</a>	get/set method for summary data description</li>
<li><a href="../marsbar/@marsy/ui_plot.html" class="code" title="function r = ui_plot(o, plot_spec, plot_params)">ui_plot</a>	method plots data in various formats</li>
<li><a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>	wrapper function for MarsBaR marmoire object</li>
<li><a href="mars_build_roi.html" class="code" title="function o = mars_build_roi">mars_build_roi</a>	builds ROIs via the SPM GUI</li>
<li><a href="mars_image_scaling.html" class="code" title="function [VY,row] = mars_image_scaling(marsD)">mars_image_scaling</a>	get image scaling data for images, maybe via SPM design</li>
<li><a href="mars_img2rois.html" class="code" title="function mars_img2rois(P, roipath, rootn, flags)">mars_img2rois</a>	creates ROIs from cluster image or image containing ROIs defined by unique nos</li>
<li><a href="mars_options.html" class="code" title="function [mars, msgstr] = mars_options(optstr, mars, cfg_fname)">mars_options</a>	options utility routines</li>
<li><a href="mars_rois2img.html" class="code" title="function mars_rois2img(roi_list, img_name, roi_space, flags)">mars_rois2img</a>	creates cluster or number labelled ROI image from ROIs</li>
<li><a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>	multifunction function for manipulating structures</li>
<li><a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>	wrapper for matlab uiputfile/getfile; to resolve version differences</li>
<li><a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>	collection of useful utility functions for MarsBaR etc</li>
<li><a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>	Startup, callback and utility routine for Marsbar</li>
<li><a href="savestruct.html" class="code" title="function savestruct(varargin)">savestruct</a>	saves data in structure as variables in .mat file</li>
<li><a href="../marsbar/spm2/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>	returns SPM version specific parameters</li>
<li><a href="../marsbar/spm5/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>	returns SPM version specific parameters</li>
<li><a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>	compatibility function to allow spm_get calls with SPM5</li>
<li><a href="../marsbar/spm99/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>	returns SPM version specific parameters</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../marsbar/@mardo/mardo.html" class="code" title="function [o, others] = mardo(params, others, passf)">mardo</a>	mardo - class constructor for MarsBaR design object</li>
<li><a href="../marsbar/@mardo_2/mardo_2.html" class="code" title="function [o, others] = mardo_2(params, others, varargin)">mardo_2</a>	class constructor for SPM2 MarsBaR design object</li>
<li><a href="../marsbar/@mardo_2/private/pr_fmri_design.html" class="code" title="function [SPM] = pr_fmri_design(SPM)">pr_fmri_design</a>	MarsBaR version of spm_fMRI design - asssembles a design for fMRI studies</li>
<li><a href="../marsbar/@mardo_2/private/pr_spm_ui.html" class="code" title="function varargout = pr_spm_ui(varargin)">pr_spm_ui</a>	MarsBaR: setting up the general linear model for independent data</li>
<li><a href="../marsbar/@mardo_5/mardo_5.html" class="code" title="function [o, others] = mardo_5(params, others, varargin)">mardo_5</a>	class constructor for SPM5 MarsBaR design object</li>
<li><a href="../marsbar/@mardo_5/private/pr_fmri_design.html" class="code" title="function [SPM] = pr_fmri_design(SPM)">pr_fmri_design</a>	MarsBaR version of spm_fMRI design - asssembles a design for fMRI studies</li>
<li><a href="../marsbar/@mardo_5/private/pr_spm_ui.html" class="code" title="function varargout = pr_spm_ui(varargin)">pr_spm_ui</a>	MarsBaR: Setting up the general linear model for independent data</li>
<li><a href="../marsbar/@mardo_99/mardo_99.html" class="code" title="function [o, others] = mardo_99(params, others, varargin)">mardo_99</a>	class constructor for SPM99 MarsBaR design object</li>
<li><a href="../marsbar/@mardo_99/private/pr_fmri_design.html" class="code" title="function [SPM] = pr_fmri_design(SPM)">pr_fmri_design</a>	MarsBaR version of spm_fMRI design - asssembles a design for fMRI studies</li>
<li><a href="../marsbar/@mardo_99/private/pr_spm_ui.html" class="code" title="function varargout=pr_spm_ui(varargin)">pr_spm_ui</a>	MarsBaR: setting up the general linear model for independent data</li>
<li><a href="../marsbar/@marmoire/marmoire.html" class="code" title="function [o, others] = marmoire(params, varargin)">marmoire</a>	marmoire - class constructor for marmoire container type</li>
<li><a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>	maroi - class constructor for umbrella ROI object</li>
<li><a href="../marsbar/@marsy/marsy.html" class="code" title="function [o,others] = marsy(params, region_stuff, summary_stuff)">marsy</a>	Class constructor for marsy: the MarsBaR data object</li>
<li><a href="../marsbar/examples/batch/run_preprocess.html" class="code" title="">run_preprocess</a>	Run smoothing and SPM analysis for MarsBaR ER sample data</li>
<li><a href="../marsbar/examples/batch/run_tutorial.html" class="code" title="">run_tutorial</a>	MarsBaR batch script to show off MarsBaR batching</li>
<li><a href="mars_blob2roi.html" class="code" title="function mars_blob2roi(xSPM, pt)">mars_blob2roi</a>	saves ROI for cluster in xSPM structure, containing point pt</li>
<li><a href="mars_options.html" class="code" title="function [mars, msgstr] = mars_options(optstr, mars, cfg_fname)">mars_options</a>	options utility routines</li>
<li><a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>	Startup, callback and utility routine for Marsbar</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function sum_func = sf_get_sumfunc(sum_func)</a></li>
<li><a href="#_sub2" class="code">function btn = sf_prev_save(obj_name)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout=marsbar(varargin) </a>
0002 <span class="comment">% Startup, callback and utility routine for Marsbar</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% MarsBaR: Marseille Boite a Regions d'interet</span>
0005 <span class="comment">%          Marseille Region of Interest Toolbox</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% MarsBaR (the collection of files listed by contents.m) is copyright under</span>
0008 <span class="comment">% the GNU general public license.  Please see mars_licence.man for details.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Marsbar written and copyright claimed by</span>
0011 <span class="comment">% Jean-Luc Anton, Matthew Brett, Jean-Baptiste Poline, Romain Valabregue</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Portions of the code rely heavily on (or are copied from) SPM</span>
0014 <span class="comment">% (http://www.fil.ion.ucl.ac.uk/spm), which is also released under the GNU</span>
0015 <span class="comment">% public licence.  Many thanks the SPM authors: (John Ashburner, Karl Friston,</span>
0016 <span class="comment">% Andrew Holmes et al, and of course our own Jean-Baptiste).</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% This software is MarsBaRWare. It is written in the hope that it is</span>
0019 <span class="comment">% helpful; if you find it so, please let us know by sending a Mars bar to:</span>
0020 <span class="comment">% The Jean-Luc confectionery collection, Centre IRMf, CHU La Timone, 264,</span>
0021 <span class="comment">% Rue Saint Pierre 13385 Marseille Cedex 05, France</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% If you find that it actively hinders your work, do send an</span>
0024 <span class="comment">% elderly sardine to the same address.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% Please visit our friends at The Visible Mars Bar project:</span>
0027 <span class="comment">% http://totl.net/VisibleMars</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% $Id$</span>
0030 
0031 <span class="comment">% Programmer's help</span>
0032 <span class="comment">% -----------------</span>
0033 <span class="comment">% For a list of the functions implemented here, try</span>
0034 <span class="comment">% grep &quot;^case &quot; marsbar.m</span>
0035 
0036 <span class="comment">% Marsbar version</span>
0037 MBver = <span class="string">'0.45'</span>;  <span class="comment">% First Github release</span>
0038 
0039 <span class="comment">% Various working variables in global variable structure</span>
0040 <span class="keyword">global</span> MARS;
0041 
0042 <span class="comment">%-Format arguments</span>
0043 <span class="comment">%-----------------------------------------------------------------------</span>
0044 <span class="keyword">if</span> nargin == 0, Action=<span class="string">'Startup'</span>; <span class="keyword">else</span>, Action = varargin{1}; <span class="keyword">end</span>
0045 
0046 <span class="comment">%=======================================================================</span>
0047 <span class="keyword">switch</span> lower(Action), <span class="keyword">case</span> <span class="string">'startup'</span>                     <span class="comment">%-Start marsbar</span>
0048 <span class="comment">%=======================================================================</span>
0049 
0050 <span class="comment">%-Turn on warning messages for debugging</span>
0051 warning backtrace
0052 
0053 <span class="comment">% splash screen once per session</span>
0054 splashf = ~<a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'is_started'</span>);
0055 
0056 <span class="comment">% promote spm directory to top of path, read defaults</span>
0057 <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'on'</span>);
0058 
0059 <span class="comment">% Workaround for bizarre linux uigetfile problem: see</span>
0060 <span class="comment">% http://www.mathworks.com/support/bugreports/details.html?rp=259878</span>
0061 <span class="comment">% (or search Mathworks support for uigetfile linux</span>
0062 mlv = version; mlv = str2num(mlv(1:3));
0063 <span class="keyword">if</span> mlv &gt;= 7 &amp;&amp; strcmp(computer, <span class="string">'GLNX86'</span>)
0064   <span class="keyword">if</span> usejava(<span class="string">'jvm'</span>)
0065     setappdata(0,<span class="string">'UseNativeSystemDialogs'</span>,false)
0066   <span class="keyword">else</span>
0067     warning([<span class="string">'Matlab 7, linux, no java, please see FAQ for '</span><span class="keyword">...</span>
0068          <span class="string">'information on problems with file selection dialogs'</span>]);
0069   <span class="keyword">end</span>
0070 <span class="keyword">end</span>
0071 
0072 <span class="comment">%-Open startup window, set window defaults</span>
0073 <span class="comment">%-----------------------------------------------------------------------</span>
0074 S = get(0,<span class="string">'ScreenSize'</span>);
0075 <span class="keyword">if</span> all(S==1), error(<span class="string">'Can''t open any graphics windows...'</span>), <span class="keyword">end</span>
0076 PF = spm_platform(<span class="string">'fonts'</span>);
0077 
0078 <span class="comment">% Splash screen</span>
0079 <span class="comment">%------------------------------------------</span>
0080 <span class="keyword">if</span> splashf
0081   <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'splash'</span>);
0082 <span class="keyword">end</span>
0083 
0084 <span class="comment">%-Draw marsbar window</span>
0085 <span class="comment">%-----------------------------------------------------------------------</span>
0086 Fmenu = <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'CreateMenuWin'</span>,<span class="string">'off'</span>);
0087 
0088 <span class="comment">%-Reveal windows</span>
0089 <span class="comment">%-----------------------------------------------------------------------</span>
0090 set([Fmenu],<span class="string">'Visible'</span>,<span class="string">'on'</span>)
0091 
0092 <span class="comment">%=======================================================================</span>
0093 <span class="keyword">case</span> <span class="string">'on'</span>                                           <span class="comment">%-Initialise MarsBaR</span>
0094 <span class="comment">%=======================================================================</span>
0095 
0096 <span class="comment">% promote spm replacement directory</span>
0097 <span class="comment">% remove incorrect spm replacement directories</span>
0098 mbpath = fileparts(which(<span class="string">'marsbar.m'</span>));
0099 spmV = <a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>(<span class="string">'spm_version'</span>);
0100 m_spm_paths = {<span class="string">'spm99'</span>, <span class="string">'spm2'</span>, <span class="string">'spm5'</span>};
0101 v_path = lower(spmV);
0102 <span class="comment">% spm8 is effectively identical to spm5 for marsbar</span>
0103 <span class="keyword">switch</span> v_path
0104 <span class="keyword">case</span> {<span class="string">'spm8'</span>, <span class="string">'spm12b'</span>, <span class="string">'spm12'</span>}
0105     v_path = <span class="string">'spm5'</span>;
0106 <span class="keyword">end</span>
0107 w_s = warning;
0108 warning off
0109 <span class="keyword">for</span> p = m_spm_paths(~ismember(m_spm_paths, v_path))
0110   rmpath(fullfile(mbpath, char(p)))
0111 <span class="keyword">end</span>
0112 warning(w_s)
0113 MARS.ADDPATHS = {fullfile(mbpath, v_path)};
0114 addpath(MARS.ADDPATHS{:}, <span class="string">'-begin'</span>);
0115 fprintf(<span class="string">'MarsBaR analysis functions prepended to path\n'</span>);
0116 
0117 <span class="comment">% check SPM defaults are loaded</span>
0118 <a href="../marsbar/spm2/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>(<span class="string">'defaults'</span>);
0119 
0120 <span class="comment">% set up the ARMOIRE stuff</span>
0121 <span class="comment">% see marmoire help for details</span>
0122 <span class="keyword">if</span> <a href="../marsbar/@mardo/isfield.html" class="code" title="function result = isfield(this, fieldn)">isfield</a>(MARS, <span class="string">'ARMOIRE'</span>)
0123   o = MARS.ARMOIRE; 
0124 <span class="keyword">else</span>
0125   o = <a href="../marsbar/@marmoire/marmoire.html" class="code" title="function [o, others] = marmoire(params, varargin)">marmoire</a>;
0126 <span class="keyword">end</span>
0127 
0128 spm_design_filter = <a href="../marsbar/spm2/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>(<span class="string">'design_filter_spec'</span>);
0129 filter_specs  = {[spm_design_filter(1,:);<span class="keyword">...</span>
0130           {<span class="string">'*_mdes.mat'</span>,<span class="string">'MarsBaR: *_mdes.mat'</span>}; <span class="keyword">...</span>
0131           spm_design_filter(2:<span class="keyword">end</span>,:)], <span class="keyword">...</span>
0132          {<span class="string">'*_mdata.mat'</span>,<span class="string">'MarsBaR data file (*_mdata.mat)'</span>},<span class="keyword">...</span>
0133          {<span class="string">'*_mres.mat'</span>, <span class="string">'MarsBaR results (*_mres.mat)'</span>}};
0134 
0135 o = <a href="../marsbar/@marmoire/add_if_absent.html" class="code" title="function o = add_if_absent(o, item, data)">add_if_absent</a>(o, <span class="string">'def_design'</span>, <span class="keyword">...</span>
0136           struct(<span class="string">'default_file_name'</span>, <span class="string">'untitled_mdes.mat'</span>,<span class="keyword">...</span><span class="comment">      </span>
0137              <span class="string">'filter_spec'</span>, {filter_specs{1}},<span class="keyword">...</span>
0138              <span class="string">'title'</span>, <span class="string">'Default design'</span>,<span class="keyword">...</span>
0139              <span class="string">'set_action'</span>,<span class="string">'mars_arm_call(''set_design'',o,item,old_o)'</span>));
0140 o = <a href="../marsbar/@marmoire/add_if_absent.html" class="code" title="function o = add_if_absent(o, item, data)">add_if_absent</a>(o, <span class="string">'roi_data'</span>,<span class="keyword">...</span>
0141           struct(<span class="string">'default_file_name'</span>, <span class="string">'untitled_mdata.mat'</span>,<span class="keyword">...</span>
0142              <span class="string">'filter_spec'</span>, {filter_specs{2}},<span class="keyword">...</span>
0143              <span class="string">'title'</span>, <span class="string">'ROI data'</span>,<span class="keyword">...</span>
0144              <span class="string">'set_action'</span>,<span class="string">'mars_arm_call(''set_data'',o,item,old_o)'</span>));
0145 o = <a href="../marsbar/@marmoire/add_if_absent.html" class="code" title="function o = add_if_absent(o, item, data)">add_if_absent</a>(o, <span class="string">'est_design'</span>,<span class="keyword">...</span>
0146           struct(<span class="string">'default_file_name'</span>, <span class="string">'untitled_mres.mat'</span>,<span class="keyword">...</span>
0147              <span class="string">'filter_spec'</span>, {filter_specs{3}},<span class="keyword">...</span>
0148              <span class="string">'title'</span>, <span class="string">'MarsBaR estimated design'</span>,<span class="keyword">...</span>
0149              <span class="string">'set_action'</span>, <span class="string">'mars_arm_call(''set_results'',o,item,old_o)'</span>));
0150 MARS.ARMOIRE = o;
0151 
0152 <span class="comment">% and workspace</span>
0153 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isfield.html" class="code" title="function result = isfield(this, fieldn)">isfield</a>(MARS, <span class="string">'WORKSPACE'</span>), MARS.WORKSPACE = []; <span class="keyword">end</span>
0154 
0155 <span class="comment">% read any necessary defaults</span>
0156 <span class="keyword">if</span> ~<a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'isthere'</span>, MARS, <span class="string">'OPTIONS'</span>)
0157   loadf = 1;
0158   MARS.OPTIONS = [];
0159 <span class="keyword">else</span>
0160   loadf = 0;
0161 <span class="keyword">end</span>
0162 [mbdefs sourcestr] = <a href="mars_options.html" class="code" title="function [mars, msgstr] = mars_options(optstr, mars, cfg_fname)">mars_options</a>(<span class="string">'Defaults'</span>);
0163 MARS.OPTIONS = <a href="mars_options.html" class="code" title="function [mars, msgstr] = mars_options(optstr, mars, cfg_fname)">mars_options</a>(<span class="string">'fill'</span>,MARS.OPTIONS, mbdefs);
0164 <a href="mars_options.html" class="code" title="function [mars, msgstr] = mars_options(optstr, mars, cfg_fname)">mars_options</a>(<span class="string">'put'</span>);
0165 <span class="keyword">if</span> loadf
0166   fprintf(<span class="string">'Loaded MarsBaR defaults from %s\n'</span>,sourcestr);
0167 <span class="keyword">end</span>
0168 
0169 <span class="comment">% Add very very odd fix for maroi object path problem</span>
0170 <span class="comment">% and matlab 7.1 (at least)</span>
0171 <span class="comment">% Don't ask why this is needed - I don't know.</span>
0172 <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>;
0173 
0174 <span class="comment">%=======================================================================</span>
0175 <span class="keyword">case</span> <span class="string">'off'</span>                                              <span class="comment">%-Unload MarsBaR</span>
0176 <span class="comment">%=======================================================================</span>
0177 <span class="comment">% res = marsbar('Off')</span>
0178 <span class="comment">%-----------------------------------------------------------------------</span>
0179 varargout = {0};
0180 
0181 <span class="comment">% leave if no signs of marsbar</span>
0182 <span class="keyword">if</span> ~<a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'is_started'</span>), <span class="keyword">return</span>, <span class="keyword">end</span>
0183 
0184 <span class="comment">% save outstanding information</span>
0185 btn = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'save_ui'</span>, <span class="string">'all'</span>, struct(<span class="string">'ync'</span>, 1, <span class="string">'no_no_save'</span>, 1));
0186 <span class="keyword">if</span> btn == -1, varargout = {-1}; <span class="keyword">return</span>, <span class="keyword">end</span> <span class="comment">% cancel</span>
0187 
0188 <span class="comment">% remove marsbar added directories</span>
0189 rmpath(MARS.ADDPATHS{:});
0190 fprintf(<span class="string">'MarsBaR analysis functions removed from path\n'</span>);
0191 
0192 <span class="comment">%=======================================================================</span>
0193 <span class="keyword">case</span> <span class="string">'quit'</span>                                        <span class="comment">%-Quit MarsBaR window</span>
0194 <span class="comment">%=======================================================================</span>
0195 <span class="comment">% marsbar('Quit')</span>
0196 <span class="comment">%-----------------------------------------------------------------------</span>
0197 
0198 <span class="comment">% do path stuff, save any pending changes</span>
0199 <span class="keyword">if</span> <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'off'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span> <span class="comment">% check for cancel</span>
0200 
0201 <span class="comment">% leave if no signs of MARSBAR</span>
0202 <span class="keyword">if</span> ~<a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'is_started'</span>), <span class="keyword">return</span>, <span class="keyword">end</span>
0203 
0204 <span class="comment">%-Close any existing 'MarsBaR' 'Tag'ged windows</span>
0205 delete(spm_figure(<span class="string">'FindWin'</span>,<span class="string">'MarsBaR'</span>))
0206 fprintf(<span class="string">'Au revoir...\n\n'</span>)
0207 
0208 <span class="comment">%=======================================================================</span>
0209 <span class="keyword">case</span> <span class="string">'is_started'</span>        <span class="comment">%-returns 1 if MarsBaR GUI has been initialized</span>
0210 <span class="comment">%=======================================================================</span>
0211 <span class="comment">% tf  = marsbar('is_started')</span>
0212 varargout = {~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(MARS)};
0213 
0214 <span class="comment">%=======================================================================</span>
0215 <span class="keyword">case</span> <span class="string">'cfgfile'</span>                                  <span class="comment">%-finds MarsBaR cfg file</span>
0216 <span class="comment">%=======================================================================</span>
0217 <span class="comment">% cfgfn  = marsbar('cfgfile')</span>
0218 cfgfile = <span class="string">'marsbarcfg.mat'</span>;
0219 varargout = {which(cfgfile), cfgfile}; 
0220 
0221 <span class="comment">%=======================================================================</span>
0222 <span class="keyword">case</span> <span class="string">'createmenuwin'</span>                          <span class="comment">%-Draw MarsBaR menu window</span>
0223 <span class="comment">%=======================================================================</span>
0224 <span class="comment">% Fmenu = marsbar('CreateMenuWin',Vis)</span>
0225 <span class="keyword">if</span> nargin&lt;2, Vis=<span class="string">'on'</span>; <span class="keyword">else</span>, Vis=varargin{2}; <span class="keyword">end</span>
0226 
0227 <span class="comment">%-Close any existing 'MarsBaR' 'Tag'ged windows</span>
0228 delete(spm_figure(<span class="string">'FindWin'</span>,<span class="string">'MarsBaR'</span>))
0229 
0230 <span class="comment">% Version etc info</span>
0231 [MBver,MBc] = <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'Ver'</span>);
0232 
0233 <span class="comment">%-Get size and scalings and create Menu window</span>
0234 <span class="comment">%-----------------------------------------------------------------------</span>
0235 WS   = spm(<span class="string">'WinScale'</span>);                <span class="comment">%-Window scaling factors</span>
0236 FS   = spm(<span class="string">'FontSizes'</span>);            <span class="comment">%-Scaled font sizes</span>
0237 PF   = spm_platform(<span class="string">'fonts'</span>);            <span class="comment">%-Font names (for this platform)</span>
0238 Rect = [50 600 300 275];               <span class="comment">%-Raw size menu window rectangle</span>
0239 bno = 6; bgno = bno+1;
0240 bgapr = 0.25;
0241 bh = Rect(4) / (bno + bgno*bgapr);      <span class="comment">% Button height</span>
0242 gh = bh * bgapr;                        <span class="comment">% Button gap</span>
0243 by = fliplr(cumsum([0 ones(1, bno-1)*(bh+gh)])+gh);
0244 bx = Rect(3)*0.1;
0245 bw = Rect(3)*0.8;
0246 Fmenu = figure(<span class="string">'IntegerHandle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0247     <span class="string">'Name'</span>,sprintf(<span class="string">'%s'</span>,MBc),<span class="keyword">...</span>
0248     <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0249     <span class="string">'Tag'</span>,<span class="string">'MarsBaR'</span>,<span class="keyword">...</span>
0250     <span class="string">'Position'</span>,Rect.*WS,<span class="keyword">...</span>
0251     <span class="string">'Resize'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0252     <span class="string">'Color'</span>,[1 1 1]*.8,<span class="keyword">...</span>
0253     <span class="string">'UserData'</span>,struct(<span class="string">'MBver'</span>,MBver,<span class="string">'MBc'</span>,MBc),<span class="keyword">...</span>
0254     <span class="string">'MenuBar'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0255     <span class="string">'DefaultTextFontName'</span>,PF.helvetica,<span class="keyword">...</span>
0256     <span class="string">'DefaultTextFontSize'</span>,FS(12),<span class="keyword">...</span>
0257     <span class="string">'DefaultUicontrolFontName'</span>,PF.helvetica,<span class="keyword">...</span>
0258     <span class="string">'DefaultUicontrolFontSize'</span>,FS(12),<span class="keyword">...</span>
0259     <span class="string">'DefaultUicontrolInterruptible'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0260     <span class="string">'Renderer'</span>,<span class="string">'painters'</span>,<span class="keyword">...</span>
0261     <span class="string">'Visible'</span>,<span class="string">'off'</span>);
0262 
0263 <span class="comment">%-Objects with Callbacks - main MarsBaR routines</span>
0264 <span class="comment">%=======================================================================</span>
0265 
0266 funcs = {<span class="string">'mars_display_roi(''display'');'</span>,<span class="keyword">...</span>
0267      <span class="string">'mars_blob_ui;'</span>,<span class="keyword">...</span>
0268      <span class="string">'marsbar(''buildroi'');'</span>,<span class="keyword">...</span>
0269      <span class="string">'marsbar(''transform'');'</span>,<span class="keyword">...</span>
0270      <span class="string">'marsbar(''import_rois'');'</span>,<span class="keyword">...</span>
0271      <span class="string">'marsbar(''export_rois'');'</span>};
0272 
0273 uicontrol(Fmenu,<span class="string">'Style'</span>,<span class="string">'PopUp'</span>,<span class="keyword">...</span>
0274       <span class="string">'String'</span>,[<span class="string">'ROI definition'</span>,<span class="keyword">...</span>
0275             <span class="string">'|View...'</span><span class="keyword">...</span>
0276             <span class="string">'|Get SPM cluster(s)...'</span><span class="keyword">...</span>
0277             <span class="string">'|Build...'</span>,<span class="keyword">...</span>
0278             <span class="string">'|Transform...'</span>,<span class="keyword">...</span>
0279             <span class="string">'|Import...'</span>,<span class="keyword">...</span>
0280             <span class="string">'|Export...'</span>],<span class="keyword">...</span>
0281       <span class="string">'Position'</span>,[bx by(1) bw bh].*WS,<span class="keyword">...</span>
0282       <span class="string">'ToolTipString'</span>,<span class="string">'Draw / build / combine ROIs...'</span>,<span class="keyword">...</span>
0283       <span class="string">'CallBack'</span>,<span class="string">'spm(''PopUpCB'',gcbo)'</span>,<span class="keyword">...</span>
0284       <span class="string">'UserData'</span>,funcs);
0285 
0286 <span class="comment">% Design menu</span>
0287 fw_st = <span class="string">'struct(''force'', 1, ''warn_empty'', 1)'</span>;
0288 funcs = {<span class="keyword">...</span>
0289     <span class="string">'marsbar(''make_design'', ''pet'');'</span>,<span class="keyword">...</span>
0290     <span class="string">'marsbar(''make_design'', ''fmri'');'</span>,<span class="keyword">...</span>
0291     <span class="string">'marsbar(''make_design'', ''basic'');'</span>,<span class="keyword">...</span>
0292     <span class="string">'marsbar(''design_report'')'</span>,<span class="keyword">...</span>
0293     <span class="string">'marsbar(''design_filter'')'</span>,<span class="keyword">...</span>
0294     <span class="string">'marsbar(''add_images'')'</span>,<span class="keyword">...</span>
0295     <span class="string">'marsbar(''edit_filter'')'</span>,<span class="keyword">...</span>
0296     <span class="string">'marsbar(''check_images'')'</span>,<span class="keyword">...</span>
0297     <span class="string">'marsbar(''list_images'')'</span>,<span class="keyword">...</span>
0298     <span class="string">'marsbar(''ana_cd'')'</span>,<span class="keyword">...</span>
0299     <span class="string">'marsbar(''ana_desmooth'')'</span>,<span class="keyword">...</span>
0300     <span class="string">'marsbar(''def_from_est'')'</span>,<span class="keyword">...</span>
0301     <span class="string">'marsbar(''set_def'')'</span>,<span class="keyword">...</span>
0302     [<span class="string">'mars_arm(''save_ui'', ''def_design'', '</span> fw_st <span class="string">');'</span>],<span class="keyword">...</span>
0303     <span class="string">'mars_arm(''show_summary'', ''def_design'')'</span>};
0304 
0305 uicontrol(Fmenu,<span class="string">'Style'</span>,<span class="string">'PopUp'</span>,<span class="keyword">...</span>
0306       <span class="string">'String'</span>,[<span class="string">'Design...'</span><span class="keyword">...</span>
0307             <span class="string">'|PET models'</span>,<span class="keyword">...</span>
0308             <span class="string">'|FMRI models'</span>,<span class="keyword">...</span>
0309             <span class="string">'|Basic models'</span>,<span class="keyword">...</span>
0310             <span class="string">'|Explore'</span>,<span class="keyword">...</span>
0311             <span class="string">'|Frequencies (event+data)'</span>,<span class="keyword">...</span>
0312             <span class="string">'|Add images to FMRI design'</span>,<span class="keyword">...</span>
0313             <span class="string">'|Add/edit filter for FMRI design'</span>,<span class="keyword">...</span><span class="comment">    </span>
0314             <span class="string">'|Check image names in design'</span>,<span class="keyword">...</span>
0315             <span class="string">'|List image names to console'</span>,<span class="keyword">...</span>
0316             <span class="string">'|Change design path to images'</span>,<span class="keyword">...</span>
0317             <span class="string">'|Convert to unsmoothed'</span>,<span class="keyword">...</span>
0318             <span class="string">'|Set design from estimated'</span>,<span class="keyword">...</span>
0319             <span class="string">'|Set design from file'</span>,<span class="keyword">...</span>
0320             <span class="string">'|Save design to file'</span>,<span class="keyword">...</span>
0321             <span class="string">'|Show default design summary'</span>],<span class="keyword">...</span>
0322       <span class="string">'Position'</span>,[bx by(2) bw bh].*WS,<span class="keyword">...</span>
0323       <span class="string">'ToolTipString'</span>,<span class="string">'Set/specify design...'</span>,<span class="keyword">...</span>
0324       <span class="string">'CallBack'</span>,<span class="string">'spm(''PopUpCB'',gcbo)'</span>,<span class="keyword">...</span>
0325       <span class="string">'UserData'</span>,funcs);
0326 
0327 <span class="comment">% Data menu</span>
0328 funcs = {<span class="string">'marsbar(''extract_data'', ''default'');'</span>,<span class="keyword">...</span>
0329      <span class="string">'marsbar(''extract_data'', ''full'');'</span>,<span class="keyword">...</span>
0330      <span class="string">'marsbar(''set_defregion'');'</span>,<span class="keyword">...</span>
0331      <span class="string">'marsbar(''plot_data'', ''raw'');'</span>,<span class="keyword">...</span>
0332      <span class="string">'marsbar(''plot_data'', ''full'');'</span>,<span class="keyword">...</span>
0333      <span class="string">'marsbar(''import_data'');'</span>,<span class="keyword">...</span>
0334      <span class="string">'marsbar(''export_data'');'</span>,<span class="keyword">...</span>
0335      <span class="string">'marsbar(''split_data'');'</span>,<span class="keyword">...</span>
0336      <span class="string">'marsbar(''join_data'');'</span>,<span class="keyword">...</span>
0337      <span class="string">'mars_arm(''set_ui'', ''roi_data'');'</span>,<span class="keyword">...</span>
0338      [<span class="string">'mars_arm(''save_ui'', ''roi_data'', '</span> fw_st <span class="string">');'</span>],<span class="keyword">...</span>
0339      <span class="string">'mars_arm(''show_summary'', ''roi_data'')'</span>};
0340 
0341 uicontrol(Fmenu,<span class="string">'Style'</span>,<span class="string">'PopUp'</span>,<span class="keyword">...</span>
0342       <span class="string">'String'</span>,[<span class="string">'Data...'</span><span class="keyword">...</span>
0343             <span class="string">'|Extract ROI data (default)'</span>,<span class="keyword">...</span>
0344             <span class="string">'|Extract ROI data (full options)'</span>,<span class="keyword">...</span>
0345             <span class="string">'|Default region...'</span>,<span class="keyword">...</span>
0346             <span class="string">'|Plot data (simple)'</span>,<span class="keyword">...</span>
0347             <span class="string">'|Plot data (full)'</span>,<span class="keyword">...</span><span class="comment">            </span>
0348             <span class="string">'|Import data'</span>,<span class="keyword">...</span>
0349             <span class="string">'|Export data'</span>,<span class="keyword">...</span>
0350             <span class="string">'|Split regions into files'</span>,<span class="keyword">...</span>
0351             <span class="string">'|Merge data files'</span>,<span class="keyword">...</span>
0352             <span class="string">'|Set data from file'</span>,<span class="keyword">...</span>
0353             <span class="string">'|Save data to file'</span>,<span class="keyword">...</span>
0354             <span class="string">'|Show data summary'</span>],<span class="keyword">...</span>
0355       <span class="string">'Position'</span>,[bx by(3) bw bh].*WS,<span class="keyword">...</span>
0356       <span class="string">'ToolTipString'</span>,<span class="string">'Extract/set/save data...'</span>,<span class="keyword">...</span>
0357       <span class="string">'CallBack'</span>,<span class="string">'spm(''PopUpCB'',gcbo)'</span>,<span class="keyword">...</span>
0358       <span class="string">'UserData'</span>,funcs);
0359 
0360 <span class="comment">% results menu</span>
0361 funcs = {<span class="keyword">...</span>
0362     <span class="string">'marsbar(''estimate'');'</span>,<span class="keyword">...</span>
0363     <span class="string">'marsbar(''merge_contrasts'');'</span>,<span class="keyword">...</span>
0364     <span class="string">'marsbar(''refresh_contrasts'');'</span>,<span class="keyword">...</span>
0365     <span class="string">'marsbar(''add_trial_f'');'</span>,<span class="keyword">...</span>
0366     <span class="string">'marsbar(''set_defcon'');'</span>,<span class="keyword">...</span>
0367     <span class="string">'marsbar(''set_defregion'');'</span>,<span class="keyword">...</span>
0368     <span class="string">'marsbar(''plot_residuals'');'</span>,<span class="keyword">...</span>
0369     <span class="string">'marsbar(''spm_graph'');'</span>,<span class="keyword">...</span>
0370     <span class="string">'marsbar(''stat_table'');'</span>,<span class="keyword">...</span>
0371     <span class="string">'marsbar(''signal_change'');'</span>,<span class="keyword">...</span>
0372     <span class="string">'marsbar(''fitted_events'');'</span>,<span class="keyword">...</span>
0373     <span class="string">'marsbar(''fir_events'');'</span>,<span class="keyword">...</span>
0374     <span class="string">'marsbar(''add_events_by_name'');'</span>,<span class="keyword">...</span>
0375     <span class="string">'marsbar(''set_results'');'</span>,<span class="keyword">...</span>
0376     [<span class="string">'mars_arm(''save_ui'', ''est_design'', '</span> fw_st <span class="string">');'</span>],<span class="keyword">...</span>
0377     <span class="string">'mars_arm(''show_summary'', ''est_design'')'</span>};
0378 
0379 uicontrol(Fmenu,<span class="string">'Style'</span>,<span class="string">'PopUp'</span>,<span class="keyword">...</span>
0380       <span class="string">'String'</span>,[<span class="string">'Results...'</span><span class="keyword">...</span>
0381             <span class="string">'|Estimate results'</span>,<span class="keyword">...</span>
0382             <span class="string">'|Import contrasts'</span>,<span class="keyword">...</span>
0383             <span class="string">'|Refresh F contrasts'</span>,<span class="keyword">...</span>
0384             <span class="string">'|Add trial-specific F'</span>,<span class="keyword">...</span>
0385             <span class="string">'|Default contrast...'</span>,<span class="keyword">...</span>
0386             <span class="string">'|Default region...'</span>,<span class="keyword">...</span>
0387             <span class="string">'|Plot residuals'</span>,<span class="keyword">...</span>
0388             <span class="string">'|MarsBaR SPM graph'</span>,<span class="keyword">...</span>
0389             <span class="string">'|Statistic table'</span>,<span class="keyword">...</span>
0390             <span class="string">'|% signal change'</span>,<span class="keyword">...</span>
0391             <span class="string">'|Fitted event time course'</span>,<span class="keyword">...</span>
0392             <span class="string">'|FIR event time course'</span>,<span class="keyword">...</span><span class="comment">            </span>
0393             <span class="string">'|Add event types by name'</span>,<span class="keyword">...</span>
0394             <span class="string">'|Set results from file'</span>,<span class="keyword">...</span>
0395             <span class="string">'|Save results to file'</span>,<span class="keyword">...</span>
0396             <span class="string">'|Show estimated design summary'</span>],<span class="keyword">...</span>
0397       <span class="string">'Position'</span>,[bx by(4) bw bh].*WS,<span class="keyword">...</span>
0398       <span class="string">'ToolTipString'</span>,<span class="string">'Write/display contrasts...'</span>,<span class="keyword">...</span>
0399       <span class="string">'CallBack'</span>,<span class="string">'spm(''PopUpCB'',gcbo)'</span>,<span class="keyword">...</span>
0400       <span class="string">'UserData'</span>,funcs);
0401 
0402 <span class="comment">% options menu</span>
0403 funcs = {[<span class="string">'global MARS; '</span><span class="keyword">...</span>
0404      <span class="string">'MARS.OPTIONS=mars_options(''edit'');mars_options(''put'');'</span>],<span class="keyword">...</span>
0405      [<span class="string">'global MARS; '</span><span class="keyword">...</span>
0406       <span class="string">'[MARS.OPTIONS str]=mars_options(''defaults'');'</span> <span class="keyword">...</span>
0407       <span class="string">'mars_options(''put''); '</span><span class="keyword">...</span>
0408       <span class="string">'fprintf(''Defaults loaded from %s\n'', str)'</span>],<span class="keyword">...</span>
0409      [<span class="string">'global MARS; '</span><span class="keyword">...</span>
0410       <span class="string">'[MARS.OPTIONS str]=mars_options(''basedefaults'');'</span> <span class="keyword">...</span>
0411       <span class="string">'mars_options(''put''); '</span><span class="keyword">...</span>
0412       <span class="string">'fprintf(''Defaults loaded from %s\n'', str)'</span>],<span class="keyword">...</span>
0413      [<span class="string">'global MARS; '</span><span class="keyword">...</span>
0414       <span class="string">'MARS.OPTIONS=mars_options(''load'');mars_options(''put'');'</span>],<span class="keyword">...</span>
0415      <span class="string">'mars_options(''save'');'</span><span class="keyword">...</span>
0416     };
0417      
0418 uicontrol(Fmenu,<span class="string">'Style'</span>,<span class="string">'PopUp'</span>,<span class="keyword">...</span>
0419       <span class="string">'String'</span>,[<span class="string">'Options...'</span><span class="keyword">...</span>
0420             <span class="string">'|Edit options'</span><span class="keyword">...</span>
0421             <span class="string">'|Restore defaults'</span><span class="keyword">...</span>
0422             <span class="string">'|Base defaults'</span>,<span class="keyword">...</span>
0423             <span class="string">'|Set options from file'</span><span class="keyword">...</span>
0424             <span class="string">'|Save options to file'</span>],<span class="keyword">...</span>
0425       <span class="string">'Position'</span>,[bx by(5) bw bh].*WS,<span class="keyword">...</span>
0426       <span class="string">'ToolTipString'</span>,<span class="string">'Load/save/edit MarsBaR options'</span>,<span class="keyword">...</span>
0427       <span class="string">'CallBack'</span>,<span class="string">'spm(''PopUpCB'',gcbo)'</span>,<span class="keyword">...</span>
0428       <span class="string">'UserData'</span>,funcs);
0429 
0430 <span class="comment">% quit button</span>
0431 uicontrol(Fmenu,<span class="string">'String'</span>,<span class="string">'Quit'</span>,<span class="keyword">...</span>
0432       <span class="string">'Position'</span>,[bx by(6) bw bh].*WS,<span class="keyword">...</span>
0433       <span class="string">'ToolTipString'</span>,<span class="string">'exit MarsBaR'</span>,<span class="keyword">...</span>
0434       <span class="string">'ForeGroundColor'</span>,<span class="string">'r'</span>,<span class="keyword">...</span>
0435       <span class="string">'Interruptible'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0436       <span class="string">'CallBack'</span>,<span class="string">'marsbar(''Quit'')'</span>);
0437 
0438 <span class="comment">% Set quit action if MarsBaR window is closed</span>
0439 <span class="comment">%-----------------------------------------------------------------------</span>
0440 set(Fmenu,<span class="string">'CloseRequestFcn'</span>,<span class="string">'marsbar(''Quit'')'</span>)
0441 set(Fmenu,<span class="string">'Visible'</span>,Vis)
0442 
0443 varargout = {Fmenu};
0444 
0445 <span class="comment">%=======================================================================</span>
0446 <span class="keyword">case</span> {<span class="string">'ver'</span>, <span class="string">'version'</span>}                         <span class="comment">%-Return MarsBaR version</span>
0447 <span class="comment">%=======================================================================</span>
0448 <span class="comment">% [v [,banner]] = marsbar('Ver')</span>
0449 <span class="comment">%-----------------------------------------------------------------------</span>
0450 varargout = {MBver, <span class="string">'MarsBaR - Marseille ROI toolbox'</span>};
0451 
0452 <span class="comment">%=======================================================================</span>
0453 <span class="keyword">case</span> <span class="string">'splash'</span>                                       <span class="comment">%-show splash screen</span>
0454 <span class="comment">%=======================================================================</span>
0455 <span class="comment">% marsbar('splash')</span>
0456 <span class="comment">%-----------------------------------------------------------------------</span>
0457 <span class="comment">% Shows splash screen</span>
0458 WS   = spm(<span class="string">'WinScale'</span>);        <span class="comment">%-Window scaling factors</span>
0459 [X,map] = imread(<span class="string">'marsbar.jpg'</span>);
0460 aspct = size(X,1) / size(X,2);
0461 ww = 400;
0462 srect = [200 300 ww ww*aspct] .* WS;   <span class="comment">%-Scaled size splash rectangle</span>
0463 h = figure(<span class="string">'visible'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0464        <span class="string">'menubar'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0465        <span class="string">'numbertitle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0466        <span class="string">'name'</span>,<span class="string">'Welcome to MarsBaR'</span>,<span class="keyword">...</span>
0467        <span class="string">'pos'</span>,srect);
0468 im = image(X);
0469 colormap(map);
0470 ax = get(im, <span class="string">'Parent'</span>);
0471 axis off;
0472 axis image;
0473 axis tight;
0474 set(ax,<span class="string">'plotboxaspectratiomode'</span>,<span class="string">'manual'</span>,<span class="keyword">...</span>
0475        <span class="string">'unit'</span>,<span class="string">'pixels'</span>,<span class="keyword">...</span>
0476        <span class="string">'pos'</span>,[0 0 srect(3:4)]);
0477 set(h,<span class="string">'visible'</span>,<span class="string">'on'</span>);
0478 pause(3);
0479 close(h);
0480  
0481 <span class="comment">%=======================================================================</span>
0482 <span class="keyword">case</span> <span class="string">'buildroi'</span>                                     <span class="comment">%-build and save ROI</span>
0483 <span class="comment">%=======================================================================</span>
0484 <span class="comment">% o = marsbar('buildroi')</span>
0485 <span class="comment">%-----------------------------------------------------------------------</span>
0486 <span class="comment">% build and save object</span>
0487 varargout = {[]};
0488 o = <a href="mars_build_roi.html" class="code" title="function o = mars_build_roi">mars_build_roi</a>;
0489 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(o)
0490   varargout = {<a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'saveroi'</span>, o)};
0491 <span class="keyword">end</span>
0492 
0493 <span class="comment">%=======================================================================</span>
0494 <span class="keyword">case</span> <span class="string">'transform'</span>                                        <span class="comment">%-transform ROIs</span>
0495 <span class="comment">%=======================================================================</span>
0496 <span class="comment">% marsbar('transform')</span>
0497 <span class="comment">%-----------------------------------------------------------------------</span>
0498 <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'mars_menu'</span>, <span class="string">'Transform ROI'</span>, <span class="string">'Transform:'</span>, <span class="keyword">...</span>
0499     {{<span class="string">'combinerois'</span>},{<span class="string">'flip_lr'</span>}},<span class="keyword">...</span>
0500     {<span class="string">'Combine ROIs'</span>,<span class="string">'Flip L/R'</span>});
0501 
0502 <span class="comment">%=======================================================================</span>
0503 <span class="keyword">case</span> <span class="string">'import_rois'</span>                                       <span class="comment">%- import ROIs!</span>
0504 <span class="comment">%=======================================================================</span>
0505 <span class="comment">% marsbar('import_rois')</span>
0506 <span class="comment">%-----------------------------------------------------------------------</span>
0507 
0508 <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'mars_menu'</span>, <span class="string">'Import ROIs'</span>, <span class="string">'Import ROIs from:'</span>,<span class="keyword">...</span>
0509     {{<span class="string">'img2rois'</span>,<span class="string">'c'</span>},<span class="keyword">...</span>
0510      {<span class="string">'img2rois'</span>,<span class="string">'i'</span>}},<span class="keyword">...</span>
0511     {<span class="string">'cluster image'</span>,<span class="keyword">...</span>
0512      <span class="string">'number labelled ROI image'</span>});
0513 
0514 <span class="comment">%=======================================================================</span>
0515 <span class="keyword">case</span> <span class="string">'export_rois'</span>                                         <span class="comment">%-export ROIs</span>
0516 <span class="comment">%=======================================================================</span>
0517 <span class="comment">% marsbar('export_rois')</span>
0518 <span class="comment">%-----------------------------------------------------------------------</span>
0519 
0520 <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'mars_menu'</span>, <span class="string">'Export ROI(s)'</span>, <span class="string">'Export ROI(s) to:'</span>,<span class="keyword">...</span>
0521     {{<span class="string">'roi_as_image'</span>},<span class="keyword">...</span>
0522      {<span class="string">'rois2img'</span>, <span class="string">'c'</span>},<span class="keyword">...</span>
0523      {<span class="string">'rois2img'</span>, <span class="string">'i'</span>}},<span class="keyword">...</span>
0524     {<span class="string">'image'</span>, <span class="string">'cluster image'</span>,<span class="keyword">...</span>
0525     <span class="string">'number labelled ROI image'</span>});
0526 
0527 <span class="comment">%=======================================================================</span>
0528 <span class="keyword">case</span> <span class="string">'img2rois'</span>                                       <span class="comment">%-import ROI image</span>
0529 <span class="comment">%=======================================================================</span>
0530 <span class="comment">%  marsbar('img2rois', roi_type)</span>
0531 <span class="comment">%-----------------------------------------------------------------------</span>
0532 
0533 <span class="keyword">if</span> nargin &lt; 2
0534   roi_type = <span class="string">'c'</span>; <span class="comment">% default is cluster image</span>
0535 <span class="keyword">else</span>
0536   roi_type = varargin{2};
0537 <span class="keyword">end</span>
0538 <a href="mars_img2rois.html" class="code" title="function mars_img2rois(P, roipath, rootn, flags)">mars_img2rois</a>(<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,roi_type);
0539 
0540 <span class="comment">%=======================================================================</span>
0541 <span class="keyword">case</span> <span class="string">'rois2img'</span>                                       <span class="comment">%-export ROI image</span>
0542 <span class="comment">%=======================================================================</span>
0543 <span class="comment">%  marsbar('roi2img', roi_type)</span>
0544 <span class="comment">%-----------------------------------------------------------------------</span>
0545 
0546 <span class="keyword">if</span> nargin &lt; 2
0547   roi_type = <span class="string">'c'</span>; <span class="comment">% default is cluster image</span>
0548 <span class="keyword">else</span>
0549   roi_type = varargin{2};
0550 <span class="keyword">end</span>
0551 <a href="mars_rois2img.html" class="code" title="function mars_rois2img(roi_list, img_name, roi_space, flags)">mars_rois2img</a>(<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,roi_type);
0552 
0553 <span class="comment">%=======================================================================</span>
0554 <span class="keyword">case</span> <span class="string">'saveroi'</span>                                                <span class="comment">%-save ROI</span>
0555 <span class="comment">%=======================================================================</span>
0556 <span class="comment">% o = marsbar('saveroi', obj, flags)</span>
0557 <span class="comment">%-----------------------------------------------------------------------</span>
0558 <span class="comment">% flags will usually be empty, or one or more characters from</span>
0559 <span class="comment">% 'n'   do not ask for label or description</span>
0560 <span class="comment">% 'l'   use label to make filename, rather than source field</span>
0561 
0562 <span class="keyword">if</span> nargin &lt; 2 || <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(varargin{2})
0563   <span class="keyword">return</span>
0564 <span class="keyword">end</span>
0565 <span class="keyword">if</span> nargin &lt; 3
0566   flags = <span class="string">''</span>;
0567 <span class="keyword">else</span>
0568   flags = varargin{3};
0569 <span class="keyword">end</span>
0570 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(flags), flags = <span class="string">' '</span>; <span class="keyword">end</span>
0571 o = varargin{2};
0572 varargout = {[]};
0573 
0574 <span class="comment">% Label, description</span>
0575 <span class="keyword">if</span> ~any(flags==<span class="string">'n'</span>)
0576   d = spm_input(<span class="string">'Description of ROI'</span>, <span class="string">'+1'</span>, <span class="string">'s'</span>, <a href="../marsbar/@mardo/descrip.html" class="code" title="function strs = descrip(D)">descrip</a>(o));
0577   o = <a href="../marsbar/@mardo/descrip.html" class="code" title="function strs = descrip(D)">descrip</a>(o,d);
0578   l = spm_input(<span class="string">'Label for ROI'</span>, <span class="string">'+1'</span>, <span class="string">'s'</span>, <a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>(o));
0579   o = <a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>(o,l);
0580 <span class="keyword">end</span>
0581 
0582 fn = <a href="../marsbar/@maroi/source.html" class="code" title="function h = source(obj, val)">source</a>(o);
0583 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(fn) || any(flags==<span class="string">'l'</span>)
0584   fn = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'filename'</span>, <a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>(<span class="string">'str2fname'</span>, <a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>(o)));
0585 <span class="keyword">end</span>
0586 
0587 f_f = [<span class="string">'*'</span> <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'fileend'</span>)];
0588 [f p] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'put'</span>, <span class="keyword">...</span>
0589             {f_f, [<span class="string">'ROI files ('</span> f_f <span class="string">')'</span>]},<span class="keyword">...</span>
0590             <span class="string">'File name for ROI'</span>, fn);
0591 <span class="keyword">if</span> any(f~=0)
0592   roi_fname = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'filename'</span>, fullfile(p, f));
0593   <span class="keyword">try</span>
0594     varargout = {<a href="../marsbar/@maroi/saveroi.html" class="code" title="function roi = saveroi(roi, fname)">saveroi</a>(o, roi_fname)};
0595   <span class="keyword">catch</span>
0596     warning([lasterr <span class="string">' Error saving ROI to file '</span> roi_fname])
0597   <span class="keyword">end</span>
0598 <span class="keyword">end</span>
0599 
0600 <span class="comment">%=======================================================================</span>
0601 <span class="keyword">case</span> <span class="string">'combinerois'</span>                                        <span class="comment">%-combine ROIs</span>
0602 <span class="comment">%=======================================================================</span>
0603 <span class="comment">% marsbar('combinerois')</span>
0604 <span class="comment">%-----------------------------------------------------------------------</span>
0605 roilist = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>(Inf,[<span class="string">'*'</span> <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'fileend'</span>)], <span class="keyword">...</span>
0606           <span class="string">'Select ROI(s) to combine'</span>);
0607 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roilist)
0608   <span class="keyword">return</span>
0609 <span class="keyword">end</span>
0610 roilist = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'load_cell'</span>, roilist);
0611 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Combine ROIs'</span>);
0612 spm_input(<span class="string">'(r1 &amp; r2) &amp; ~r3'</span>,1,<span class="string">'d'</span>,<span class="string">'Example function:'</span>);
0613 func = spm_input(<span class="string">'Function to combine ROIs'</span>, <span class="string">'+1'</span>, <span class="string">'s'</span>, <span class="string">''</span>);
0614 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(func), retnrn, <span class="keyword">end</span>
0615 <span class="keyword">for</span> i = 1:length(roilist)
0616   eval(sprintf(<span class="string">'r%d = roilist{%d};'</span>, i, i));
0617 <span class="keyword">end</span>
0618 <span class="keyword">try</span>
0619   eval([<span class="string">'o='</span> func <span class="string">';'</span>]);
0620 <span class="keyword">catch</span>
0621   warning([<span class="string">'Hmm, probem with function '</span> func <span class="string">': '</span> lasterr]);
0622   <span class="keyword">return</span>
0623 <span class="keyword">end</span>
0624 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(o)
0625   warning(<span class="string">'Empty object resulted'</span>);
0626   <span class="keyword">return</span>
0627 <span class="keyword">end</span>
0628 <span class="keyword">if</span> <a href="../marsbar/@maroi_box/is_empty_roi.html" class="code" title="function tf = is_empty_roi(o)">is_empty_roi</a>(o)
0629   warning(<span class="string">'No volume resulted for ROI'</span>);
0630   <span class="keyword">return</span>
0631 <span class="keyword">end</span>
0632 
0633 <span class="comment">% save ROI</span>
0634 <span class="keyword">if</span> isa(o, <span class="string">'maroi'</span>)
0635   o = <a href="../marsbar/@maroi/label.html" class="code" title="function h = label(obj, val)">label</a>(o, func);
0636   o = <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'saveroi'</span>, o); 
0637   <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(o)
0638     fprintf(<span class="string">'\nSaved ROI as %s\n'</span>, <a href="../marsbar/@maroi/source.html" class="code" title="function h = source(obj, val)">source</a>(o));
0639   <span class="keyword">end</span>
0640 <span class="keyword">else</span>
0641   warning(sprintf(<span class="string">'\nNo ROI resulted from function %s...\n'</span>, func));
0642 <span class="keyword">end</span>
0643 
0644 <span class="comment">%=======================================================================</span>
0645 <span class="keyword">case</span> <span class="string">'flip_lr'</span>                                          <span class="comment">%-flip roi L&lt;-&gt;R</span>
0646 <span class="comment">%=======================================================================</span>
0647 <span class="comment">% marsbar('flip_lr')</span>
0648 <span class="comment">%-----------------------------------------------------------------------</span>
0649 roilist = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 1],[<span class="string">'*'</span> <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'fileend'</span>)],<span class="keyword">...</span>
0650           <span class="string">'Select ROI to flip L/R'</span>);
0651 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roilist)
0652   <span class="keyword">return</span>
0653 <span class="keyword">end</span>
0654 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Flip ROI L&lt;-&gt;R'</span>);
0655 o = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'load'</span>, roilist);
0656 o = <a href="../marsbar/@maroi/flip_lr.html" class="code" title="function o = flip_lr(o)">flip_lr</a>(o);
0657 
0658 <span class="comment">% save ROI</span>
0659 o = <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'saveroi'</span>, o, <span class="string">'l'</span>); 
0660 fprintf(<span class="string">'\nSaved ROI as %s\n'</span>, <a href="../marsbar/@maroi/source.html" class="code" title="function h = source(obj, val)">source</a>(o));
0661 
0662 <span class="comment">%=======================================================================</span>
0663 <span class="keyword">case</span> <span class="string">'show_volume'</span>                  <span class="comment">%- shows ROI volume in mm to console</span>
0664 <span class="comment">%=======================================================================</span>
0665 <span class="comment">% marsbar('show_volume')</span>
0666 <span class="comment">%-----------------------------------------------------------------------</span>
0667 roi_names = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 Inf], <span class="string">'*roi.mat'</span>, <span class="string">'Select ROIs tp get volume'</span>);
0668 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi_names),<span class="keyword">return</span>,<span class="keyword">end</span>
0669 rois = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'load_cell'</span>, roi_names);
0670 <span class="keyword">for</span> i = 1:size(rois, 1)
0671   fprintf(<span class="string">'Volume of %s: %6.2f\n'</span>, <a href="../marsbar/@maroi/source.html" class="code" title="function h = source(obj, val)">source</a>(rois{i}), <a href="../marsbar/@maroi/volume.html" class="code" title="function v = volume(obj)">volume</a>(rois{i}));
0672 <span class="keyword">end</span>
0673 <span class="keyword">return</span>
0674 
0675 <span class="comment">%=======================================================================</span>
0676 <span class="keyword">case</span> <span class="string">'roi_as_image'</span>                               <span class="comment">%- writes ROI as image</span>
0677 <span class="comment">%=======================================================================</span>
0678 <span class="comment">% marsbar('roi_as_image')</span>
0679 <span class="comment">%-----------------------------------------------------------------------</span>
0680 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Write ROI to image'</span>);
0681 
0682 roi = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 1], <span class="string">'*roi.mat'</span>, <span class="string">'Select ROI to write'</span>);
0683 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi),<span class="keyword">return</span>,<span class="keyword">end</span>
0684 [pn fn ext] = fileparts(roi);
0685 roi = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'load'</span>, roi);
0686 
0687 <span class="comment">% space of object</span>
0688 spopts = {<span class="string">'spacebase'</span>,<span class="string">'image'</span>};
0689 splabs =  {<span class="string">'Base space for ROIs'</span>,<span class="string">'From image'</span>};
0690 <span class="keyword">if</span> <a href="../marsbar/@maroi/has_space.html" class="code" title="function tf = has_space(obj)">has_space</a>(roi)
0691   spopts = {spopts{:} <span class="string">'native'</span>};
0692   splabs = {splabs{:} <span class="string">'ROI native space'</span>};
0693 <span class="keyword">end</span>
0694 spo = spm_input(<span class="string">'Space for ROI image'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>,splabs,<span class="keyword">...</span>
0695         spopts, 1);
0696 <span class="keyword">switch</span> char(spo)
0697  <span class="keyword">case</span> <span class="string">'spacebase'</span>
0698    sp = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'spacebase'</span>);
0699  <span class="keyword">case</span> <span class="string">'image'</span>
0700   img = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 1], <a href="../marsbar/spm2/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>(<span class="string">'get_img_ext'</span>), <span class="string">'Image defining space'</span>);
0701   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(img),<span class="keyword">return</span>,<span class="keyword">end</span>
0702   sp = <a href="../marsbar/@mars_space/mars_space.html" class="code" title="function [o, others] = mars_space(params, params2)">mars_space</a>(img);
0703  <span class="keyword">case</span> <span class="string">'native'</span>
0704   sp = [];
0705 <span class="keyword">end</span>
0706 
0707 <span class="comment">% remove ROI file ending</span>
0708 gend = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'fileend'</span>);
0709 lg = length(gend);
0710 f2 = [fn ext];
0711 <span class="keyword">if</span> length(f2)&gt;=lg &amp;&amp; strcmp(gend, [f2(end - lg +1 : end)])
0712   f2 = f2(1:end-lg);
0713 <span class="keyword">else</span>
0714   f2 = fn;
0715 <span class="keyword">end</span>
0716 
0717 fname = <a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>(<span class="string">'get_img_name'</span>, f2);
0718 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(fname), <span class="keyword">return</span>, <span class="keyword">end</span>
0719 <a href="../marsbar/@maroi/save_as_image.html" class="code" title="function v = save_as_image(o, fname, sp)">save_as_image</a>(roi, fname, sp);
0720 fprintf(<span class="string">'Saved ROI as %s\n'</span>,fname);
0721 
0722 <span class="comment">%=======================================================================</span>
0723 <span class="keyword">case</span> <span class="string">'attach_image'</span>                          <span class="comment">%- attaches image to ROI(s)</span>
0724 <span class="comment">%=======================================================================</span>
0725 <span class="comment">% marsbar('attach_image' [,img [,roilist]])</span>
0726 <span class="comment">%-----------------------------------------------------------------------</span>
0727 <span class="keyword">if</span> nargin &lt; 2
0728   V = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 1], <a href="../marsbar/spm2/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>(<span class="string">'get_img_ext'</span>), <span class="string">'Image to attach'</span>);
0729   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(V), <span class="keyword">return</span>, <span class="keyword">end</span>
0730 <span class="keyword">else</span>
0731   V = varargin{1};
0732 <span class="keyword">end</span>
0733 <span class="keyword">if</span> nargin &lt; 3
0734   rois = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 Inf], [<span class="string">'*'</span> <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'classdata'</span>, <span class="string">'fileend'</span>)], <span class="keyword">...</span>
0735          <span class="string">'Select ROIs to attach image to'</span>);
0736   
0737   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(rois), <span class="keyword">return</span>, <span class="keyword">end</span>
0738 <span class="keyword">else</span>
0739   rois = varargin{2};
0740 <span class="keyword">end</span>
0741 <span class="keyword">if</span> ischar(V), V = spm_vol(V); <span class="keyword">end</span>
0742 <span class="keyword">for</span> i = 1:size(rois, 1)
0743   n = deblank(rois(i,:));
0744   <span class="keyword">try</span> 
0745     r = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'load'</span>, n);
0746   <span class="keyword">catch</span>
0747     r = []
0748     <span class="keyword">if</span> ~strmatch(lasterr, <span class="string">'Cant map image file.'</span>)
0749       error(lasterr);
0750     <span class="keyword">end</span>
0751   <span class="keyword">end</span>
0752   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(r)
0753     <span class="keyword">continue</span>
0754   <span class="keyword">end</span>
0755   <span class="keyword">if</span> ~isa(r, <span class="string">'maroi_image'</span>)
0756     fprintf(<span class="string">'ROI %s is not an image ROI - ignored\n'</span>, n);
0757     <span class="keyword">continue</span>
0758   <span class="keyword">end</span>
0759 
0760   r = <a href="../marsbar/@maroi_image/vol.html" class="code" title="function h = vol(obj, val)">vol</a>(r, V);
0761   <a href="../marsbar/@maroi/saveroi.html" class="code" title="function roi = saveroi(roi, fname)">saveroi</a>(r, n);
0762   fprintf(<span class="string">'Saved ROI %s, attached to image %s\n'</span>,<span class="keyword">...</span>
0763       n, V.fname)
0764 <span class="keyword">end</span>
0765 <span class="keyword">return</span>
0766 
0767 <span class="comment">%=======================================================================</span>
0768 <span class="keyword">case</span> <span class="string">'make_design'</span>                       <span class="comment">%-runs design creation routines</span>
0769 <span class="comment">%=======================================================================</span>
0770 <span class="comment">% marsbar('make_design', des_type)</span>
0771 <span class="comment">%-----------------------------------------------------------------------</span>
0772 <span class="keyword">if</span> nargin &lt; 2
0773   des_type = <span class="string">'basic'</span>;
0774 <span class="keyword">else</span>
0775   des_type = varargin{2};
0776 <span class="keyword">end</span>
0777 <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction btn = sf_prev_save(obj_name)">sf_prev_save</a>(<span class="string">'def_design'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span>
0778 D = <a href="../marsbar/@mardo_2/ui_build.html" class="code" title="function D = ui_build(D, dtype)">ui_build</a>(<a href="../marsbar/spm2/mars_veropts.html" class="code" title="function varargout = mars_veropts(arg, varargin)">mars_veropts</a>(<span class="string">'default_design'</span>), des_type);
0779 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'def_design'</span>, D);
0780 <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'design_report'</span>);
0781 
0782 <span class="comment">%=======================================================================</span>
0783 <span class="keyword">case</span> <span class="string">'list_images'</span>                     <span class="comment">%-lists image files in SPM design</span>
0784 <span class="comment">%=======================================================================</span>
0785 <span class="comment">% marsbar('list_images')</span>
0786 <span class="comment">%-----------------------------------------------------------------------</span>
0787 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0788 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>;
0789 <span class="keyword">if</span> <a href="../marsbar/@mardo/has_images.html" class="code" title="function tf = has_images(o)">has_images</a>(marsD)
0790   P = <a href="../marsbar/@mardo/image_names.html" class="code" title="function P = image_names(D)">image_names</a>(marsD);
0791   strvcat(P{:})
0792 <span class="keyword">else</span>
0793   disp(<span class="string">'Design does not contain images'</span>);
0794 <span class="keyword">end</span>
0795 
0796 <span class="comment">%=======================================================================</span>
0797 <span class="keyword">case</span> <span class="string">'check_images'</span>                   <span class="comment">%-checks image files in SPM design</span>
0798 <span class="comment">%=======================================================================</span>
0799 <span class="comment">% marsbar('check_images')</span>
0800 <span class="comment">%-----------------------------------------------------------------------</span>
0801 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0802 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>;
0803 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/has_images.html" class="code" title="function tf = has_images(o)">has_images</a>(marsD)
0804   disp(<span class="string">'Design does not contain images'</span>);
0805   <span class="keyword">return</span>
0806 <span class="keyword">end</span>
0807 
0808 P = <a href="../marsbar/@mardo/image_names.html" class="code" title="function P = image_names(D)">image_names</a>(marsD);
0809 P = strvcat(P{:});
0810 ok_f = 1;
0811 <span class="keyword">for</span> i = 1:size(P, 1)
0812   fname = deblank(P(i,:));
0813   <span class="keyword">if</span> ~exist(fname, <span class="string">'file'</span>);
0814     fprintf(<span class="string">'Image %d: %s does not exist\n'</span>, i, fname);
0815     ok_f = 0;
0816   <span class="keyword">end</span>
0817 <span class="keyword">end</span>
0818 <span class="keyword">if</span> ok_f
0819   disp(<span class="string">'All images in design appear to exist'</span>);
0820 <span class="keyword">end</span>
0821 
0822 <span class="comment">%=======================================================================</span>
0823 <span class="keyword">case</span> <span class="string">'ana_cd'</span>                      <span class="comment">%-changes path to files in SPM design</span>
0824 <span class="comment">%=======================================================================</span>
0825 <span class="comment">% marsbar('ana_cd')</span>
0826 <span class="comment">%-----------------------------------------------------------------------</span>
0827 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0828 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>;
0829 
0830 <span class="comment">% Setup input window</span>
0831 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Change image path in design'</span>, 0);
0832 
0833 <span class="comment">% root path shown in output window</span>
0834 P = <a href="../marsbar/@mardo/image_names.html" class="code" title="function P = image_names(D)">image_names</a>(marsD);
0835 P = strvcat(P{:});
0836 root_names = spm_str_manip(P, <span class="string">'H'</span>);
0837 spm_input(deblank(root_names(1,:)),1,<span class="string">'d'</span>,<span class="string">'Common path is:'</span>);
0838 
0839 <span class="comment">% new root</span>
0840 newpath = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([-1 0], <span class="string">''</span>, <span class="string">'New directory root for files'</span>);
0841 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(newpath), <span class="keyword">return</span>, <span class="keyword">end</span>
0842 
0843 <span class="comment">% do</span>
0844 marsD = <a href="../marsbar/@mardo/cd_images.html" class="code" title="function D = cd_images(D, newpath, byteswap)">cd_images</a>(marsD, newpath);
0845 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'def_design'</span>, marsD);
0846 
0847 <span class="comment">%=======================================================================</span>
0848 <span class="keyword">case</span> <span class="string">'ana_desmooth'</span>           <span class="comment">%-makes new SPM design for unsmoothed data</span>
0849 <span class="comment">%=======================================================================</span>
0850 <span class="comment">% marsbar('ana_desmooth')</span>
0851 <span class="comment">%-----------------------------------------------------------------------</span>
0852 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0853 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>;
0854 marsD = <a href="../marsbar/@mardo/prefix_images.html" class="code" title="function D = prefix_images(D, action, prefix, flags)">prefix_images</a>(marsD, <span class="string">'remove'</span>, <span class="string">'s'</span>);
0855 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'def_design'</span>, marsD);
0856 disp(<span class="string">'Done'</span>);
0857 
0858 <span class="comment">%=======================================================================</span>
0859 <span class="keyword">case</span> <span class="string">'add_images'</span>                            <span class="comment">%-add images to FMRI design</span>
0860 <span class="comment">%=======================================================================</span>
0861 <span class="comment">% marsbar('add_images')</span>
0862 <span class="comment">%-----------------------------------------------------------------------</span>
0863 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0864 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>
0865 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>
0866 marsD = <a href="../marsbar/@mardo_2/fill.html" class="code" title="function D = fill(D, actions)">fill</a>(marsD, {<span class="string">'images'</span>});
0867 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'def_design'</span>, marsD);
0868 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set_param'</span>, <span class="string">'def_design'</span>, <span class="string">'file_name'</span>, <span class="string">''</span>);
0869 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'show_summary'</span>, <span class="string">'def_design'</span>);
0870 
0871 <span class="comment">%=======================================================================</span>
0872 <span class="keyword">case</span> <span class="string">'edit_filter'</span>                   <span class="comment">%-add / edit filter for FMRI design</span>
0873 <span class="comment">%=======================================================================</span>
0874 <span class="comment">% marsbar('edit_filter')</span>
0875 <span class="comment">%-----------------------------------------------------------------------</span>
0876 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0877 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>
0878 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>
0879 tmp = {<span class="string">'filter'</span>};
0880 <span class="keyword">if</span> ~strcmp(<a href="../marsbar/@mardo/type.html" class="code" title="function str = type(o)">type</a>(marsD), <span class="string">'SPM99'</span>), tmp = [tmp {<span class="string">'autocorr'</span>}]; <span class="keyword">end</span>
0881 marsD = <a href="../marsbar/@mardo_2/fill.html" class="code" title="function D = fill(D, actions)">fill</a>(marsD, tmp);
0882 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'def_design'</span>, marsD);
0883 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set_param'</span>, <span class="string">'def_design'</span>, <span class="string">'file_name'</span>, <span class="string">''</span>);
0884 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'show_summary'</span>, <span class="string">'def_design'</span>);
0885 
0886 <span class="comment">%=======================================================================</span>
0887 <span class="keyword">case</span> <span class="string">'def_from_est'</span>          <span class="comment">%-sets default design from estimated design</span>
0888 <span class="comment">%=======================================================================</span>
0889 <span class="comment">% marsbar('def_from_est')</span>
0890 <span class="comment">%-----------------------------------------------------------------------</span>
0891 marsE = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
0892 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsE), <span class="keyword">return</span>, <span class="keyword">end</span>;
0893 errf = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'def_design'</span>, marsE);
0894 <span class="keyword">if</span> ~errf, <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'design_report'</span>); <span class="keyword">end</span>
0895 
0896 <span class="comment">%=======================================================================</span>
0897 <span class="keyword">case</span> <span class="string">'set_def'</span>                           <span class="comment">%-sets default design using GUI</span>
0898 <span class="comment">%=======================================================================</span>
0899 <span class="comment">% marsbar('set_def')</span>
0900 <span class="comment">%-----------------------------------------------------------------------</span>
0901 <span class="keyword">if</span> <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set_ui'</span>, <span class="string">'def_design'</span>), <span class="keyword">return</span>, <span class="keyword">end</span>
0902 <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'design_report'</span>);
0903 
0904 <span class="comment">%=======================================================================</span>
0905 <span class="keyword">case</span> <span class="string">'design_report'</span>                         <span class="comment">%-does explore design thing</span>
0906 <span class="comment">%=======================================================================</span>
0907 <span class="comment">% marsbar('design_report')</span>
0908 <span class="comment">%-----------------------------------------------------------------------</span>
0909 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0910 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>;
0911 spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Explore design'</span>, 0);
0912 
0913 fprintf(<span class="string">'%-40s: '</span>,<span class="string">'Design reporting'</span>);
0914 <a href="../marsbar/@mardo_2/ui_report.html" class="code" title="function varargout = ui_report(D, varargin)">ui_report</a>(marsD, <span class="string">'DesMtx'</span>);
0915 <a href="../marsbar/@mardo_2/ui_report.html" class="code" title="function varargout = ui_report(D, varargin)">ui_report</a>(marsD, <span class="string">'DesRepUI'</span>);
0916 fprintf(<span class="string">'%30s\n'</span>,<span class="string">'...done'</span>);
0917 
0918 <span class="comment">%=======================================================================</span>
0919 <span class="keyword">case</span> <span class="string">'design_filter'</span>                      <span class="comment">%-shows FFT of data and design</span>
0920 <span class="comment">%=======================================================================</span>
0921 <span class="comment">% marsbar('design_filter')</span>
0922 <span class="comment">%-----------------------------------------------------------------------</span>
0923 marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0924 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>;
0925 marsY = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'roi_data'</span>);
0926 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsY), <span class="keyword">return</span>, <span class="keyword">end</span>
0927 <span class="comment">% If the design and data didn't match, the design will have been cleared</span>
0928 <span class="keyword">if</span> <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'isempty'</span>, <span class="string">'def_design'</span>)
0929   error(<span class="string">'Need data and design with matching number of rows'</span>);
0930 <span class="keyword">end</span>
0931 <a href="../marsbar/@mardo/ui_ft_design_data.html" class="code" title="function ui_ft_design_data(D, mY, e_s, opts)">ui_ft_design_data</a>(marsD, marsY);
0932 
0933 <span class="comment">%=======================================================================</span>
0934 <span class="keyword">case</span> <span class="string">'extract_data'</span>                       <span class="comment">% gets data maybe using design</span>
0935 <span class="comment">%=======================================================================</span>
0936 <span class="comment">% marsY = marsbar('extract_data'[, roi_list [, 'full'|'default']]);</span>
0937 
0938 <span class="keyword">if</span> nargin &lt; 2
0939   etype = <span class="string">'default'</span>;
0940 <span class="keyword">else</span>
0941   etype = varargin{2};
0942 <span class="keyword">end</span>
0943 <span class="keyword">if</span> nargin &lt; 3
0944   roi_list = <span class="string">''</span>;
0945 <span class="keyword">else</span>
0946   roi_list = varargin{3};
0947 <span class="keyword">end</span>
0948 
0949 varargout = {[]};
0950 
0951 <span class="comment">% Check for save of current data</span>
0952 <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction btn = sf_prev_save(obj_name)">sf_prev_save</a>(<span class="string">'roi_data'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span>
0953 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi_list)
0954   roi_list = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>(Inf,<span class="string">'*roi.mat'</span>,<span class="string">'Select ROI(s) to extract data for'</span>);
0955 <span class="keyword">end</span>
0956 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(roi_list), <span class="keyword">return</span>, <span class="keyword">end</span>
0957 
0958 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Extract data'</span>, 0);
0959 
0960 <span class="keyword">if</span> strcmp(etype, <span class="string">'default'</span>)
0961   marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0962   <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>;
0963   <span class="keyword">if</span> ~<a href="../marsbar/@mardo/has_images.html" class="code" title="function tf = has_images(o)">has_images</a>(marsD),
0964     marsD = <a href="../marsbar/@mardo_2/fill.html" class="code" title="function D = fill(D, actions)">fill</a>(marsD, <span class="string">'images'</span>);
0965     <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'def_design'</span>, marsD);
0966   <span class="keyword">end</span>
0967   VY = marsD;
0968   row = <a href="../marsbar/@mardo_2/block_rows.html" class="code" title="function rows = block_rows(D)">block_rows</a>(marsD);
0969 <span class="keyword">else</span>  <span class="comment">% full options extraction</span>
0970   <span class="comment">% question for design</span>
0971   
0972   marsD = [];
0973   <span class="keyword">if</span> spm_input(<span class="string">'Use SPM design?'</span>, <span class="string">'+1'</span>, <span class="string">'b'</span>, <span class="string">'Yes|No'</span>, [1 0], 1)
0974     marsD = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
0975     <span class="keyword">if</span> ~<a href="../marsbar/@mardo/has_images.html" class="code" title="function tf = has_images(o)">has_images</a>(marsD),
0976       marsD = <a href="../marsbar/@mardo_2/fill.html" class="code" title="function D = fill(D, actions)">fill</a>(marsD, <span class="string">'images'</span>);
0977       <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'def_design'</span>, marsD);
0978     <span class="keyword">end</span>
0979   <span class="keyword">end</span>
0980   [VY row] = <a href="mars_image_scaling.html" class="code" title="function [VY,row] = mars_image_scaling(marsD)">mars_image_scaling</a>(marsD);
0981 <span class="keyword">end</span>
0982 
0983 <span class="comment">% Summary function</span>
0984 <a href="../marsbar/@marsy/sumfunc.html" class="code" title="function o = sumfunc(o, sumfunc)">sumfunc</a> = <a href="#_sub1" class="code" title="subfunction sum_func = sf_get_sumfunc(sum_func)">sf_get_sumfunc</a>(MARS.OPTIONS.statistics.sumfunc);
0985 
0986 <span class="comment">% ROI names to objects</span>
0987 o = <a href="../marsbar/@maroi/maroi.html" class="code" title="function [o, others] = maroi(params, varargin)">maroi</a>(<span class="string">'load_cell'</span>, roi_list);
0988 
0989 <span class="comment">% Do data extraction</span>
0990 marsY = <a href="../marsbar/@maroi/get_marsy.html" class="code" title="function marsY = get_marsy(varargin)">get_marsy</a>(o{:}, VY, <a href="../marsbar/@marsy/sumfunc.html" class="code" title="function o = sumfunc(o, sumfunc)">sumfunc</a>, <span class="string">'v'</span>);
0991 marsY = <a href="../marsbar/@mardo_2/block_rows.html" class="code" title="function rows = block_rows(D)">block_rows</a>(marsY, row);
0992 <span class="keyword">if</span> ~<a href="../marsbar/@marsy/n_regions.html" class="code" title="function n = n_regions(o)">n_regions</a>(marsY)
0993   msgbox(<span class="string">'No data returned'</span>,<span class="string">'Data extraction'</span>, <span class="string">'warn'</span>);
0994   <span class="keyword">return</span>
0995 <span class="keyword">end</span>
0996 
0997 <span class="comment">% set into armoire, and display</span>
0998 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'roi_data'</span>, marsY);
0999 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'show_summary'</span>, <span class="string">'roi_data'</span>);
1000 
1001 varargout = {marsY};
1002 
1003 <span class="comment">%=======================================================================</span>
1004 <span class="keyword">case</span> <span class="string">'plot_data'</span>                                       <span class="comment">%- it plots data!</span>
1005 <span class="comment">%=======================================================================</span>
1006 <span class="comment">% marsbar('plot_data', p_type)</span>
1007 <span class="comment">%-----------------------------------------------------------------------</span>
1008 <span class="comment">% p_type     - plot type: one of 'raw','acf','fft','all' or 'full'</span>
1009 <span class="comment">% where 'full' results in a options to filter and choice of plot</span>
1010 
1011 <span class="keyword">if</span> nargin &lt; 2
1012   p_type = [];
1013 <span class="keyword">else</span>
1014   p_type = varargin{2};
1015 <span class="keyword">end</span>
1016 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(p_type)
1017   p_type = <span class="string">'full'</span>;
1018 <span class="keyword">end</span>
1019 marsY = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'roi_data'</span>);
1020 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsY), <span class="keyword">return</span>, <span class="keyword">end</span>
1021 
1022 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Plot data'</span>, 0);
1023 <span class="keyword">if</span> strcmp(p_type, <span class="string">'full'</span>)
1024   <span class="keyword">if</span> ~<a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'isempty'</span>, <span class="string">'def_design'</span>)
1025     D = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
1026     <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(D), <span class="keyword">return</span>, <span class="keyword">end</span>
1027     <span class="keyword">if</span> <a href="../marsbar/@mardo/has_filter.html" class="code" title="function tf = has_filter(o)">has_filter</a>(D)
1028       <span class="keyword">if</span> spm_input(<span class="string">'Use design filter?'</span>, <span class="string">'+1'</span>, <span class="string">'y/n'</span>, [1 0], 1)
1029     flags = {};
1030     <span class="keyword">if</span> <a href="../marsbar/@mardo/has_whitener.html" class="code" title="function tf = has_whitener(D)">has_whitener</a>(D) 
1031       <span class="keyword">if</span> ~spm_input(<span class="string">'Use whitening filter?'</span>, <span class="string">'+1'</span>, <span class="string">'y/n'</span>, [1 0], 1)
1032         flags = <span class="string">'no_whitening'</span>;
1033       <span class="keyword">end</span>
1034     <span class="keyword">end</span>
1035     marsY = <a href="../marsbar/@mardo_2/apply_filter.html" class="code" title="function Y = apply_filter(D, Y, flags)">apply_filter</a>(D, marsY, flags);
1036       <span class="keyword">end</span>
1037     <span class="keyword">end</span>
1038   <span class="keyword">end</span>
1039   p_type = char(spm_input(<span class="string">'Type of plot'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, <span class="keyword">...</span>
1040              <span class="string">'All|Time course|FFT|ACF'</span>, <span class="keyword">...</span>
1041              {<span class="string">'all'</span>,<span class="string">'raw'</span>,<span class="string">'fft'</span>,<span class="string">'acf'</span>}));
1042 <span class="keyword">end</span>
1043 
1044 ns  = <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(marsY);
1045 rno = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>, MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_region'</span>);
1046 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(rno)
1047   fprintf(<span class="string">'Using default region: %s\n'</span>, ns{rno});
1048 <span class="keyword">end</span>
1049 <a href="../marsbar/@marsy/ui_plot.html" class="code" title="function r = ui_plot(o, plot_spec, plot_params)">ui_plot</a>(marsY, struct(<span class="string">'types'</span>, p_type, <span class="string">'r_nos'</span>, rno));
1050 
1051 <span class="comment">%=======================================================================</span>
1052 <span class="keyword">case</span> <span class="string">'import_data'</span>                                    <span class="comment">%- it imports data</span>
1053 <span class="comment">%=======================================================================</span>
1054 <span class="comment">% marsbar('import_data')</span>
1055 <span class="comment">%-----------------------------------------------------------------------</span>
1056 
1057 <span class="comment">% Check for save of current dataa</span>
1058 <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction btn = sf_prev_save(obj_name)">sf_prev_save</a>(<span class="string">'roi_data'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span>
1059 
1060 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Import data'</span>, 0);
1061 
1062 r_f = spm_input(<span class="string">'Import what?'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, <span class="keyword">...</span>
1063         [<span class="string">'Sample time courses for one region'</span><span class="keyword">...</span>
1064          <span class="string">'|Summary time course(s) for region(s)'</span>],<span class="keyword">...</span>
1065         [1 0], 2);
1066 
1067 Ls =         [<span class="string">'Matlab workspace'</span> <span class="keyword">...</span>
1068          <span class="string">'|Text file'</span>,<span class="keyword">...</span>
1069          <span class="string">'|Lotus spreadsheet'</span>];,<span class="keyword">...</span>
1070 Os =            {<span class="string">'matlab'</span>,<span class="string">'txt'</span>,<span class="string">'wk1'</span>};
1071 
1072 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(which(<span class="string">'xlsread'</span>))
1073   Ls = [Ls  <span class="string">'|Excel spreadsheet'</span>];
1074   Os = [Os {<span class="string">'xls'</span>}];
1075 <span class="keyword">end</span>
1076 
1077 src = spm_input(<span class="string">'Import fron?'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, Ls, Os, 1);
1078   
1079 <span class="keyword">switch</span> src{1}
1080  <span class="keyword">case</span> <span class="string">'matlab'</span>
1081   Y = spm_input(<span class="string">'Matlab expression'</span>, <span class="string">'+1'</span>, <span class="string">'e'</span>);
1082   fn = <span class="string">'Matlab input'</span>;
1083   pn_fn = lower(fn);
1084  <span class="keyword">case</span> <span class="string">'txt'</span>
1085   [fn, pn] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'get'</span>,  <span class="keyword">...</span>
1086       {<span class="string">'*.txt;*.dat;*.csv'</span>, <span class="string">'Text files (*.txt, *.dat, *.csv)'</span>; <span class="keyword">...</span>
1087        <span class="string">'*.*'</span>,                   <span class="string">'All Files (*.*)'</span>}, <span class="keyword">...</span>
1088       <span class="string">'Select a text file'</span>);
1089   <span class="keyword">if</span> isequal(fn,0), <span class="keyword">return</span>, <span class="keyword">end</span>
1090   pn_fn = fullfile(pn, fn);
1091   Y = spm_load(pn_fn);
1092  <span class="keyword">case</span> <span class="string">'wk1'</span>
1093   [fn, pn] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'get'</span>,  <span class="keyword">...</span>
1094       {<span class="string">'*.wk1'</span>, <span class="string">'Lotus spreadsheet files (*.wk1)'</span>; <span class="keyword">...</span>
1095        <span class="string">'*.*'</span>,                   <span class="string">'All Files (*.*)'</span>}, <span class="keyword">...</span>
1096       <span class="string">'Select a Lotus file'</span>);
1097   <span class="keyword">if</span> isequal(fn,0), <span class="keyword">return</span>, <span class="keyword">end</span>
1098   pn_fn = fullfile(pn, fn);
1099   Y = wk1read(pn_fn);
1100  <span class="keyword">case</span> <span class="string">'xls'</span>
1101   [fn, pn] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'get'</span>,  <span class="keyword">...</span>
1102       {<span class="string">'*.xls'</span>, <span class="string">'Excel spreadsheet files (*.xls)'</span>; <span class="keyword">...</span>
1103        <span class="string">'*.*'</span>,                   <span class="string">'All Files (*.*)'</span>}, <span class="keyword">...</span>
1104       <span class="string">'Select an Excel file'</span>);
1105   <span class="keyword">if</span> isequal(fn,0), <span class="keyword">return</span>, <span class="keyword">end</span>
1106   pn_fn = fullfile(pn, fn);
1107   Y = xlsread(pn_fn);
1108  <span class="keyword">otherwise</span>
1109   error(<span class="string">'Strange source'</span>);
1110 <span class="keyword">end</span>
1111 <span class="keyword">if</span> r_f   <span class="comment">% region data</span>
1112   s_f = <a href="#_sub1" class="code" title="subfunction sum_func = sf_get_sumfunc(sum_func)">sf_get_sumfunc</a>(MARS.OPTIONS.statistics.sumfunc);
1113   r_st = struct(<span class="string">'name'</span>, fn,<span class="keyword">...</span>
1114         <span class="string">'descrip'</span>, pn_fn);
1115   s_st = struct(<span class="string">'descrip'</span>, [<span class="string">'Region data loaded from '</span> pn_fn],<span class="keyword">...</span>
1116         <span class="string">'sumfunc'</span>, s_f);
1117   marsY = <a href="../marsbar/@marsy/marsy.html" class="code" title="function [o,others] = marsy(params, region_stuff, summary_stuff)">marsy</a>({Y},r_st, s_st);
1118   pref = <span class="string">''</span>;  <span class="comment">% Region name prefix not used, as names are set</span>
1119 <span class="keyword">else</span>     <span class="comment">% summary data</span>
1120   s_st = struct(<span class="string">'descrip'</span>, [<span class="string">'Summary data loaded from '</span> pn_fn]);
1121   marsY = <a href="../marsbar/@marsy/marsy.html" class="code" title="function [o,others] = marsy(params, region_stuff, summary_stuff)">marsy</a>(Y, <span class="string">''</span>, s_st);
1122   pref = spm_input(<span class="string">'Prefix for region names'</span>, <span class="string">'+1'</span>, <span class="string">'s'</span>, [fn <span class="string">'_'</span>]);
1123 <span class="keyword">end</span>
1124 
1125 <span class="comment">% Names</span>
1126 stop_f = 0;
1127 ns = <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(marsY, [], [], pref);
1128 spm_input(<span class="string">'Return name with spaces only to abort entry'</span>,<span class="string">'+1'</span>,<span class="string">'d'</span>);
1129 <span class="keyword">for</span> r = 1:length(ns)
1130   ns{r} = spm_input(<span class="keyword">...</span>
1131       sprintf(<span class="string">'Name for region %d'</span>, r),<span class="keyword">...</span>
1132       <span class="string">'+1'</span>, <span class="string">'s'</span>, ns{r});
1133   <span class="keyword">if</span> all(ns{r}==<span class="string">' '</span>), stop_f = 1; <span class="keyword">break</span>, <span class="keyword">end</span>
1134 <span class="keyword">end</span>
1135 <span class="keyword">if</span> ~stop_f
1136   marsY = <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(marsY, [], ns);
1137 <span class="keyword">end</span>
1138 
1139 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'roi_data'</span>, marsY);
1140 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'show_summary'</span>, <span class="string">'roi_data'</span>);
1141 disp([<span class="string">'Data loaded from '</span> pn_fn]);
1142 
1143 <span class="comment">%=======================================================================</span>
1144 <span class="keyword">case</span> <span class="string">'export_data'</span>                                            <span class="comment">%- exports</span>
1145 <span class="comment">%=======================================================================</span>
1146 <span class="comment">% marsbar('export_data')</span>
1147 <span class="comment">%-----------------------------------------------------------------------</span>
1148 marsY = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'roi_data'</span>);
1149 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsY), <span class="keyword">return</span>, <span class="keyword">end</span>
1150 
1151 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Export data'</span>, 0);
1152 
1153 r_f = spm_input(<span class="string">'Export what?'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, <span class="keyword">...</span>
1154         [<span class="string">'Sample time courses for one region'</span><span class="keyword">...</span>
1155          <span class="string">'|Summary time course(s) for region(s)'</span>],<span class="keyword">...</span>
1156         [1 0], 2);
1157 
1158 Ls =         [<span class="string">'Matlab workspace'</span> <span class="keyword">...</span>
1159          <span class="string">'|Text file'</span>,<span class="keyword">...</span>
1160          <span class="string">'|Lotus spreadsheet'</span>];,<span class="keyword">...</span>
1161 Os =            {<span class="string">'matlab'</span>,<span class="string">'txt'</span>,<span class="string">'wk1'</span>};
1162 
1163 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(which(<span class="string">'xlswrite'</span>))
1164   xls_write = 1;
1165 <span class="keyword">elseif</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(which(<span class="string">'xlswrite5'</span>))
1166   xls_write = 2;
1167 <span class="keyword">else</span>
1168   xls_write = 0;
1169 <span class="keyword">end</span>
1170 
1171 <span class="keyword">if</span> xls_write
1172   Ls = [Ls  <span class="string">'|Excel spreadsheet'</span>];
1173   Os = [Os {<span class="string">'xls'</span>}];
1174 <span class="keyword">end</span>
1175 
1176 src = spm_input(<span class="string">'Export to?'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, Ls, Os, 1);
1177 
1178 <span class="keyword">if</span> r_f
1179   rno = <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'get_region'</span>, <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(marsY));
1180   Y = <a href="../marsbar/@marsy/region_data.html" class="code" title="function res = region_data(varargin)">region_data</a>(marsY, rno);
1181   Y = Y{1};
1182 <span class="keyword">else</span>
1183   Y = <a href="../marsbar/@marsy/summary_data.html" class="code" title="function [Y,Yvar,o] = summary_data(o, sumfunc_str)">summary_data</a>(marsY);
1184 <span class="keyword">end</span>
1185 
1186 <span class="keyword">switch</span> src{1}
1187  <span class="keyword">case</span> <span class="string">'matlab'</span>
1188   str = <span class="string">''</span>;
1189   <span class="keyword">while</span> ~<a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>(<span class="string">'is_valid_varname'</span>, str)
1190     str = spm_input(<span class="string">'Matlab variable name'</span>, <span class="string">'+1'</span>, <span class="string">'s'</span>);
1191     <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(str), <span class="keyword">return</span>, <span class="keyword">end</span>
1192   <span class="keyword">end</span>
1193   assignin(<span class="string">'base'</span>, str, Y);
1194   fn = [<span class="string">'Matlab variable: '</span> str];
1195  <span class="keyword">case</span> <span class="string">'txt'</span>
1196   [fn, pn] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'put'</span>,  <span class="keyword">...</span>
1197       {<span class="string">'*.txt;*.dat;*.csv'</span>, <span class="string">'Text files (*.txt, *.dat, *.csv)'</span>; <span class="keyword">...</span>
1198        <span class="string">'*.*'</span>,                   <span class="string">'All Files (*.*)'</span>}, <span class="keyword">...</span>
1199       <span class="string">'Text file name'</span>);
1200   <span class="keyword">if</span> isequal(fn,0), <span class="keyword">return</span>, <span class="keyword">end</span>
1201   save(fullfile(pn,fn), <span class="string">'Y'</span>, <span class="string">'-ascii'</span>);
1202  <span class="keyword">case</span> <span class="string">'wk1'</span>
1203   [fn, pn] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'put'</span>,  <span class="keyword">...</span>
1204       {<span class="string">'*.wk1'</span>, <span class="string">'Lotus spreadsheet files (*.wk1)'</span>; <span class="keyword">...</span>
1205        <span class="string">'*.*'</span>,                   <span class="string">'All Files (*.*)'</span>}, <span class="keyword">...</span>
1206       <span class="string">'Lotus spreadsheet file'</span>);
1207   <span class="keyword">if</span> isequal(fn,0), <span class="keyword">return</span>, <span class="keyword">end</span>
1208   wk1write(fullfile(pn,fn), Y);
1209  <span class="keyword">case</span> <span class="string">'xls'</span>
1210   [fn, pn] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'put'</span>,  <span class="keyword">...</span>
1211       {<span class="string">'*.xls'</span>, <span class="string">'Excel spreadsheet files (*.xls)'</span>; <span class="keyword">...</span>
1212        <span class="string">'*.*'</span>,                   <span class="string">'All Files (*.*)'</span>}, <span class="keyword">...</span>
1213       <span class="string">'Excel spreadsheet file'</span>);
1214   <span class="keyword">if</span> isequal(fn,0), <span class="keyword">return</span>, <span class="keyword">end</span>
1215   <span class="keyword">if</span> xls_write == 1
1216     xlswrite(fullfile(pn,fn), Y);
1217   <span class="keyword">else</span>
1218     xlswrite5(fullfile(pn,fn), Y);
1219   <span class="keyword">end</span>
1220  <span class="keyword">otherwise</span>
1221   error(<span class="string">'Strange source'</span>);
1222 <span class="keyword">end</span>
1223 disp([<span class="string">'Data saved to '</span> fn]);
1224 
1225 <span class="comment">%=======================================================================</span>
1226 <span class="keyword">case</span> <span class="string">'split_data'</span>                <span class="comment">%- splits data into one file per region</span>
1227 <span class="comment">%=======================================================================</span>
1228 <span class="comment">% marsbar('split_data')</span>
1229 <span class="comment">%-----------------------------------------------------------------------</span>
1230 marsY = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'roi_data'</span>);
1231 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsY), <span class="keyword">return</span>, <span class="keyword">end</span>
1232 <span class="keyword">if</span> <a href="../marsbar/@marsy/n_regions.html" class="code" title="function n = n_regions(o)">n_regions</a>(marsY) == 1
1233   disp(<span class="string">'Only one region in ROI data'</span>);
1234   <span class="keyword">return</span>
1235 <span class="keyword">end</span>
1236 
1237 <span class="comment">% Setup input window</span>
1238 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Split regions to files'</span>, 0);
1239 
1240 d = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([-1 0], <span class="string">''</span>, <span class="string">'New directory root for files'</span>);
1241 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(d), <span class="keyword">return</span>, <span class="keyword">end</span>
1242 
1243 def_f = <a href="../marsbar/@marsy/summary_descrip.html" class="code" title="function res = summary_descrip(o, descrip)">summary_descrip</a>(marsY);
1244 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(def_f)
1245   def_f = <a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>(<span class="string">'str2fname'</span>, def_f);
1246 <span class="keyword">end</span>
1247 f = spm_input(<span class="string">'Root filename for regions'</span>, <span class="string">'+1'</span>, <span class="string">'s'</span>, def_f);
1248 f = <a href="mars_utils.html" class="code" title="function varargout=mars_utils(varargin)">mars_utils</a>(<span class="string">'str2fname'</span>, f);
1249 mYarr = <a href="../marsbar/@marsy/split.html" class="code" title="function o_arr = split(o)">split</a>(marsY);
1250 <span class="keyword">for</span> i = 1:length(mYarr)
1251   fname = fullfile(d, sprintf(<span class="string">'%s_region_%d_mdata.mat'</span>, f, i));
1252   <a href="savestruct.html" class="code" title="function savestruct(varargin)">savestruct</a>(mYarr(i), fname);
1253   fprintf(<span class="string">'Saved region %d as %s\n'</span>, i, fname);
1254 <span class="keyword">end</span>
1255 
1256 <span class="comment">%=======================================================================</span>
1257 <span class="keyword">case</span> <span class="string">'join_data'</span>                <span class="comment">%- joins many data files into one object</span>
1258 <span class="comment">%=======================================================================</span>
1259 <span class="comment">% marsbar('join_data')</span>
1260 <span class="comment">%-----------------------------------------------------------------------</span>
1261 
1262 <span class="comment">% Check save of current data first</span>
1263 <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction btn = sf_prev_save(obj_name)">sf_prev_save</a>(<span class="string">'roi_data'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span>
1264 
1265 P = <a href="../marsbar/spm5/spm_get.html" class="code" title="function varargout = spm_get(Action, varargin)">spm_get</a>([0 Inf], <span class="string">'*_mdata.mat'</span>, <span class="string">'Select data files to join'</span>);
1266 
1267 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(P), <span class="keyword">return</span>, <span class="keyword">end</span>
1268 <span class="keyword">for</span> i = 1:size(P,1)
1269   d_o{i} = <a href="../marsbar/@marsy/marsy.html" class="code" title="function [o,others] = marsy(params, region_stuff, summary_stuff)">marsy</a>(deblank(P(i,:)));
1270 <span class="keyword">end</span>
1271 marsY = <a href="../marsbar/@marsy/join.html" class="code" title="function o = join(varargin)">join</a>(d_o{:});
1272 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'roi_data'</span>, marsY);
1273 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'show_summary'</span>, <span class="string">'roi_data'</span>);
1274 disp(P)
1275 disp(<span class="string">'Files merged and set as current data'</span>)
1276 
1277 <span class="comment">%=======================================================================</span>
1278 <span class="keyword">case</span> <span class="string">'estimate'</span>                                       <span class="comment">%-Estimates design</span>
1279 <span class="comment">%=======================================================================</span>
1280 <span class="comment">% marsbar('estimate')</span>
1281 <span class="comment">%-----------------------------------------------------------------------</span>
1282 <span class="comment">% Sequence is bit complex here, as setting the design may clear the ROI</span>
1283 <span class="comment">% data, and setting the ROI data may clear the default design, if they</span>
1284 <span class="comment">% have different numbers of rows</span>
1285 marsD= <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'def_design'</span>);
1286 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsD), <span class="keyword">return</span>, <span class="keyword">end</span>
1287 marsY = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'roi_data'</span>);
1288 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsY), <span class="keyword">return</span>, <span class="keyword">end</span>
1289 <span class="keyword">if</span> <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'isempty'</span>, <span class="string">'def_design'</span>)
1290   error(<span class="string">'Need design and data with matching number of rows'</span>);
1291 <span class="keyword">end</span>
1292 <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction btn = sf_prev_save(obj_name)">sf_prev_save</a>(<span class="string">'est_design'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span>
1293 <span class="keyword">if</span> ~<a href="../marsbar/@mardo_2/can_mars_estimate.html" class="code" title="function tf = can_mars_estimate(D)">can_mars_estimate</a>(marsD)
1294   marsD = <a href="../marsbar/@mardo_2/fill.html" class="code" title="function D = fill(D, actions)">fill</a>(marsD, <span class="string">'for_estimation'</span>);
1295   <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'def_design'</span>, marsD);
1296 <span class="keyword">end</span>
1297 marsRes = <a href="../marsbar/@mardo_2/estimate.html" class="code" title="function [marsD] = estimate(marsD, marsY, params)">estimate</a>(marsD, marsY, struct(<span class="keyword">...</span>
1298     <span class="string">'redo_covar'</span>, 1, <span class="string">'redo_whitening'</span>, 1));
1299 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'est_design'</span>, marsRes);
1300 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'show_summary'</span>, <span class="string">'est_design'</span>);
1301 
1302 <span class="comment">%=======================================================================</span>
1303 <span class="keyword">case</span> <span class="string">'set_results'</span>          <span class="comment">%-sets estimated design into global stucture</span>
1304 <span class="comment">%=======================================================================</span>
1305 <span class="comment">% donef = marsbar('set_results')</span>
1306 <span class="comment">%-----------------------------------------------------------------------</span>
1307 <span class="comment">% Set results, put results ROI data into roi_data container</span>
1308 
1309 varargout = {0};
1310 
1311 <span class="comment">% Check if there's anything we don't want to write over</span>
1312 <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction btn = sf_prev_save(obj_name)">sf_prev_save</a>(<span class="string">'est_design'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span>
1313 <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction btn = sf_prev_save(obj_name)">sf_prev_save</a>(<span class="string">'roi_data'</span>) == -1, <span class="keyword">return</span>, <span class="keyword">end</span>
1314 
1315 <span class="comment">% Do set</span>
1316 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set_ui'</span>, <span class="string">'est_design'</span>);
1317 <span class="keyword">if</span> <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'isempty'</span>, <span class="string">'est_design'</span>), <span class="keyword">return</span>, <span class="keyword">end</span>
1318 
1319 <span class="comment">% Get design, set ROI data</span>
1320 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1321 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set'</span>, <span class="string">'roi_data'</span>, <a href="../marsbar/@mardo/get_data.html" class="code" title="function d = get_data(D)">get_data</a>(marsRes));
1322 
1323 <span class="comment">% Clear default contrast</span>
1324 <span class="keyword">if</span> <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'isthere'</span>, MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_contrast'</span>)
1325   MARS.WORKSPACE.default_contrast = [];
1326   fprintf(<span class="string">'Reset of estimated design, cleared default contrast...\n'</span>);
1327 <span class="keyword">end</span>
1328 
1329 <span class="comment">% Report on design</span>
1330 fprintf(<span class="string">'%-40s: '</span>,<span class="string">'Design reporting'</span>);
1331 <a href="../marsbar/@mardo_2/ui_report.html" class="code" title="function varargout = ui_report(D, varargin)">ui_report</a>(marsRes, <span class="string">'DesMtx'</span>);
1332 <a href="../marsbar/@mardo_2/ui_report.html" class="code" title="function varargout = ui_report(D, varargin)">ui_report</a>(marsRes, <span class="string">'DesRepUI'</span>);
1333 fprintf(<span class="string">'%30s\n'</span>,<span class="string">'...done'</span>);
1334 
1335 varargout = {1};
1336 <span class="keyword">return</span>
1337 
1338 <span class="comment">%=======================================================================</span>
1339 <span class="keyword">case</span> <span class="string">'plot_residuals'</span>                  <span class="comment">%-plots residuals from estimation</span>
1340 <span class="comment">%=======================================================================</span>
1341 <span class="comment">% marsbar('plot_residuals')</span>
1342 <span class="comment">%-----------------------------------------------------------------------</span>
1343 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1344 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsRes), <span class="keyword">return</span>, <span class="keyword">end</span>
1345 Y = <a href="../marsbar/@mardo/residuals.html" class="code" title="function r = residuals(D)">residuals</a>(marsRes);
1346 ns  = <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(Y);
1347 rno = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>, MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_region'</span>);
1348 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(rno)
1349   fprintf(<span class="string">'Using default region: %s\n'</span>, ns{rno});
1350 <span class="keyword">end</span>
1351 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Plot residuals'</span>, 1);
1352 p_type = char(spm_input(<span class="string">'Type of plot'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, <span class="keyword">...</span>
1353             <span class="string">'All|Time course|FFT|ACF'</span>, <span class="keyword">...</span>
1354             {<span class="string">'all'</span>,<span class="string">'raw'</span>,<span class="string">'fft'</span>,<span class="string">'acf'</span>}));
1355 <a href="../marsbar/@marsy/ui_plot.html" class="code" title="function r = ui_plot(o, plot_spec, plot_params)">ui_plot</a>(Y, struct(<span class="string">'types'</span>, p_type, <span class="string">'r_nos'</span>, rno));
1356 
1357 <span class="comment">%=======================================================================</span>
1358 <span class="keyword">case</span> <span class="string">'set_defcon'</span>                                 <span class="comment">%-set default contrast</span>
1359 <span class="comment">%=======================================================================</span>
1360 <span class="comment">% Ic = marsbar('set_defcon')</span>
1361 <span class="comment">%-----------------------------------------------------------------------</span>
1362 varargout = {[]};
1363 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1364 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsRes), <span class="keyword">return</span>, <span class="keyword">end</span>
1365 
1366 <span class="comment">% Setup input window</span>
1367 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Default contrast'</span>, 0);
1368 Ic = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>,MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_contrast'</span>);
1369 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(Ic)
1370   cname = <span class="string">'[Not set]'</span>;
1371 <span class="keyword">else</span> 
1372   xCon = <a href="../marsbar/@mardo/get_contrasts.html" class="code" title="function xCon = get_contrasts(D)">get_contrasts</a>(marsRes);
1373   cname = xCon(Ic).name; 
1374 <span class="keyword">end</span>
1375 spm_input(cname, 1, <span class="string">'d'</span>, <span class="string">'Default contrast'</span>);
1376 opts = {<span class="string">'Quit'</span>, <span class="string">'Set new default'</span>};
1377 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(Ic), opts = [opts {<span class="string">'Clear default contrast'</span>}]; <span class="keyword">end</span>
1378 <span class="keyword">switch</span> spm_input(<span class="string">'What to do?'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, opts, [1:length(opts)], 1);
1379  <span class="keyword">case</span> 1
1380  <span class="keyword">case</span> 2
1381   [Ic marsRes changef] = <a href="../marsbar/@mardo/ui_get_contrasts.html" class="code" title="function varargout=ui_get_contrasts(D, varargin)">ui_get_contrasts</a>(marsRes, <span class="string">'T|F'</span>,1,<span class="keyword">...</span>
1382              <span class="string">'Select default contrast'</span>,<span class="string">''</span>,1);
1383   <span class="keyword">if</span> changef
1384     <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, marsRes);
1385   <span class="keyword">end</span>
1386  <span class="keyword">case</span> 3
1387   Ic = [];
1388 <span class="keyword">end</span>
1389 MARS.WORKSPACE.default_contrast = Ic;
1390 varargout = {Ic};
1391 
1392 <span class="comment">%=======================================================================</span>
1393 <span class="keyword">case</span> <span class="string">'set_defregion'</span>                                <span class="comment">%-set default region</span>
1394 <span class="comment">%=======================================================================</span>
1395 <span class="comment">% rno = marsbar('set_defregion')</span>
1396 <span class="comment">%-----------------------------------------------------------------------</span>
1397 varargout = {[]};
1398 marsY = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'roi_data'</span>);
1399 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsY), <span class="keyword">return</span>, <span class="keyword">end</span>
1400 ns = <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(marsY);
1401 <span class="keyword">if</span> length(ns) == 1
1402   disp(<span class="string">'Only one region in data'</span>);
1403   MARS.WORKSPACE.default_region = 1;
1404   varargout = {1};
1405   <span class="keyword">return</span>
1406 <span class="keyword">end</span>
1407 
1408 <span class="comment">% Setup input window</span>
1409 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Default region'</span>, 0);
1410 rno = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>,MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_region'</span>);
1411 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(rno), rname = <span class="string">'[Not set]'</span>; <span class="keyword">else</span> rname = ns{rno}; <span class="keyword">end</span>
1412 spm_input(rname, 1, <span class="string">'d'</span>, <span class="string">'Default region:'</span>);
1413 opts = {<span class="string">'Quit'</span>, <span class="string">'Set new default'</span>};
1414 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(rno), opts = [opts {<span class="string">'Clear default region'</span>}]; <span class="keyword">end</span>
1415 <span class="keyword">switch</span> spm_input(<span class="string">'What to do?'</span>, <span class="string">'+1'</span>, <span class="string">'m'</span>, opts, [1:length(opts)], 1);
1416  <span class="keyword">case</span> 1
1417  <span class="keyword">case</span> 2
1418   rno = <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'get_region'</span>, ns);
1419   disp([<span class="string">'Default region set to: '</span> ns{rno}]); 
1420  <span class="keyword">case</span> 3
1421   rno = [];
1422 <span class="keyword">end</span>
1423 MARS.WORKSPACE.default_region = rno;
1424 varargout = {rno};
1425 
1426 <span class="comment">%=======================================================================</span>
1427 <span class="keyword">case</span> <span class="string">'get_region'</span>                                  <span class="comment">%-ui to select region</span>
1428 <span class="comment">%=======================================================================</span>
1429 <span class="comment">% select region from list box / input</span>
1430 <span class="comment">% rno = marsbar('get_region', names, prompt)</span>
1431 <span class="comment">% names is cell array of strings identifying regions</span>
1432 <span class="comment">% prompt is prompt string</span>
1433 <span class="comment">%-----------------------------------------------------------------------</span>
1434 
1435 <span class="keyword">if</span> nargin &lt; 2
1436   error(<span class="string">'Need region names to select from'</span>);
1437 <span class="keyword">else</span>
1438   names = varargin{2};
1439 <span class="keyword">end</span>
1440 <span class="keyword">if</span> nargin &lt; 3
1441   prompt = <span class="string">'Select region'</span>;
1442 <span class="keyword">else</span>
1443   prompt = varargin{3};
1444 <span class="keyword">end</span>
1445 
1446 <span class="comment">% maximum no of items in list box</span>
1447 maxlist = 200;
1448 <span class="keyword">if</span> length(names) &gt; maxlist
1449   <span class="comment">% text input, maybe</span>
1450   error(<span class="string">'Too many regions'</span>);
1451 <span class="keyword">end</span>
1452 <span class="keyword">if</span> length(names) == 1
1453   rno = 1;
1454 <span class="keyword">elseif</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(names)
1455   rno = []
1456 <span class="keyword">else</span>
1457   <span class="comment">% listbox</span>
1458   rno = spm_input(prompt, <span class="string">'+1'</span>, <span class="string">'m'</span>, names);  
1459 <span class="keyword">end</span>
1460 varargout = {rno};
1461 
1462 <span class="comment">%=======================================================================</span>
1463 <span class="keyword">case</span> <span class="string">'spm_graph'</span>                                         <span class="comment">%-run spm_graph</span>
1464 <span class="comment">%=======================================================================</span>
1465 <span class="comment">% marsbar('spm_graph')</span>
1466 <span class="comment">%-----------------------------------------------------------------------</span>
1467 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1468 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsRes), <span class="keyword">return</span>, <span class="keyword">end</span>
1469 
1470 <span class="comment">% Setup input window</span>
1471 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Mars SPM graph'</span>, 1);
1472 
1473 ns  = <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(<a href="../marsbar/@mardo/get_data.html" class="code" title="function d = get_data(D)">get_data</a>(marsRes));
1474 rno = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>, MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_region'</span>);
1475 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(rno)
1476   fprintf(<span class="string">'Using default region: %s\n'</span>, ns{rno});
1477 <span class="keyword">else</span>
1478   rno = <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'get_region'</span>, ns, <span class="string">'Select region to plot'</span>);
1479 <span class="keyword">end</span>
1480 
1481 Ic = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>, MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_contrast'</span>);
1482 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(Ic)
1483   xCon = <a href="../marsbar/@mardo/get_contrasts.html" class="code" title="function xCon = get_contrasts(D)">get_contrasts</a>(marsRes);
1484   fprintf(<span class="string">'Using default contrast: %s\n'</span>, xCon(Ic).name);
1485 <span class="keyword">end</span>
1486 
1487 <span class="comment">% Variables returned in field names to allow differences</span>
1488 <span class="comment">% in return variables between versions of spm_graph</span>
1489 [r_st marsRes changef] = <a href="../marsbar/@mardo_2/mars_spm_graph.html" class="code" title="function [r_st,marsD,changef] = mars_spm_graph(marsD,rno,Ic)">mars_spm_graph</a>(marsRes, rno, Ic);
1490 
1491 <span class="comment">% Dump field names to global workspace as variables</span>
1492 fns = fieldnames(r_st);
1493 <span class="keyword">for</span> f = 1:length(fns)
1494   assignin(<span class="string">'base'</span>, fns{f}, getfield(r_st, fns{f}));
1495 <span class="keyword">end</span>
1496 
1497 <span class="comment">% Store if changed</span>
1498 <span class="keyword">if</span> changef
1499   <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, marsRes); 
1500 <span class="keyword">end</span>
1501 
1502 <span class="comment">%=======================================================================</span>
1503 <span class="keyword">case</span> <span class="string">'stat_table'</span>                                       <span class="comment">%-run stat_table</span>
1504 <span class="comment">%=======================================================================</span>
1505 <span class="comment">% marsbar('stat_table')</span>
1506 <span class="comment">%-----------------------------------------------------------------------</span>
1507 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1508 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsRes), <span class="keyword">return</span>, <span class="keyword">end</span>
1509 Ic = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>, MARS, <span class="string">'WORKSPACE'</span>, <span class="string">'default_contrast'</span>);
1510 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(Ic)
1511   xCon = <a href="../marsbar/@mardo/get_contrasts.html" class="code" title="function xCon = get_contrasts(D)">get_contrasts</a>(marsRes);
1512   fprintf(<span class="string">'Using default contrast: %s\n'</span>, xCon(Ic).name);
1513 <span class="keyword">end</span>
1514 [strs marsS marsRes changef] = <span class="keyword">...</span><span class="comment"> </span>
1515     <a href="../marsbar/@mardo/stat_table.html" class="code" title="function [rep_strs, marsS, marsD, changef] = stat_table(marsD, Ic)">stat_table</a>(marsRes, Ic);
1516 disp(char(strs));
1517 assignin(<span class="string">'base'</span>, <span class="string">'marsS'</span>, marsS);
1518 <span class="keyword">if</span> changef
1519   <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, marsRes); 
1520 <span class="keyword">end</span>
1521 
1522 <span class="comment">%=======================================================================</span>
1523 <span class="keyword">case</span> <span class="string">'signal_change'</span>                             <span class="comment">% percent signal change</span>
1524 <span class="comment">%=======================================================================</span>
1525 <span class="comment">% marsbar('signal_change')</span>
1526 <span class="comment">%-----------------------------------------------------------------------</span>
1527 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1528 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsRes), <span class="keyword">return</span>, <span class="keyword">end</span>
1529 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>(marsRes)
1530   fprintf(<span class="string">'Need FMRI design for %% signal change\n'</span>);
1531   <span class="keyword">return</span>
1532 <span class="keyword">end</span>
1533 
1534 <span class="comment">% Setup input window</span>
1535 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Percent signal change'</span>, 0);
1536 
1537 [marsRes ic status] = <a href="../marsbar/@mardo/ui_event_types.html" class="code" title="function [D, ic, status] = ui_event_types(D)">ui_event_types</a>(marsRes);
1538 <span class="keyword">if</span> (status==0), <span class="keyword">return</span>, <span class="keyword">end</span>
1539 <span class="keyword">if</span> (status&gt;1), <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, marsRes); <span class="keyword">end</span>
1540 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(ic), <span class="keyword">return</span>, <span class="keyword">end</span>
1541 
1542 dur       = spm_input(<span class="string">'Event duration'</span>, <span class="string">'+1'</span>, <span class="string">'e'</span>, 0);
1543 
1544 <span class="comment">% Choose event difference function</span>
1545 diff_func = <a href="mars_struct.html" class="code" title="function varargout = mars_struct(action, varargin)">mars_struct</a>(<span class="string">'getifthere'</span>, MARS, <span class="string">'OPTIONS'</span>, <span class="keyword">...</span>
1546             <span class="string">'events'</span>, <span class="string">'diff_func'</span>);
1547 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(diff_func), diff_func = <span class="string">'max abs'</span>; 
1548 <span class="keyword">elseif</span> strcmp(diff_func, <span class="string">'window'</span>)
1549   spm_input(<span class="string">'Event signal change window...'</span>, <span class="string">'+1'</span>,<span class="string">'d'</span>, mfilename);
1550   <a href="../marsbar/@maroi/times.html" class="code" title="function o = times(o1, o2)">times</a> = spm_input(<span class="string">'Mean signal between times'</span>, <span class="keyword">...</span>
1551             <span class="string">'+1'</span>, <span class="string">'r'</span>, [4 6], 2, [0 dur+32]);
1552   other_args = {<a href="../marsbar/@maroi/times.html" class="code" title="function o = times(o1, o2)">times</a>, <a href="../marsbar/@mardo_2/bf_dt.html" class="code" title="function d = bf_dt(D)">bf_dt</a>(marsRes)};
1553 <span class="keyword">else</span>
1554   other_args = {};
1555 <span class="keyword">end</span>
1556 
1557 ic_len    = length(ic);
1558 et = <a href="../marsbar/@mardo/event_types.html" class="code" title="function res = event_types(D, et)">event_types</a>(marsRes);
1559 <span class="keyword">for</span> i = 1:ic_len
1560   pc(i,:) = <a href="../marsbar/@mardo/event_signal.html" class="code" title="function s = event_signal(D, e_spec, dur, diff_func, varargin)">event_signal</a>(marsRes, et(ic(i)).e_spec, dur,  <span class="keyword">...</span>
1561              diff_func, <span class="keyword">...</span>
1562              other_args{:});
1563 <span class="keyword">end</span>
1564 rns       = <a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(<a href="../marsbar/@mardo/get_data.html" class="code" title="function d = get_data(D)">get_data</a>(marsRes));
1565 disp(<span class="string">'Sort-of % signal change'</span>);
1566 disp(sprintf(<span class="string">'Duration: %3.2f seconds'</span>, dur));
1567 <span class="keyword">for</span> i = 1:ic_len
1568   disp([<span class="string">'Event: '</span> et(ic(i)).name]);
1569   <span class="keyword">for</span> r = 1:length(rns)
1570     disp(sprintf(<span class="string">'Region: %40s; %5.3f'</span>, rns{r}, pc(i, r)));
1571   <span class="keyword">end</span>
1572 <span class="keyword">end</span>
1573 assignin(<span class="string">'base'</span>, <span class="string">'pc'</span>, pc);
1574 
1575 <span class="comment">%=======================================================================</span>
1576 <span class="keyword">case</span> <span class="string">'fitted_events'</span>                    <span class="comment">% show fitted event time courses</span>
1577 <span class="comment">%=======================================================================</span>
1578 <span class="comment">% marsbar('fitted_events')</span>
1579 <span class="comment">%-----------------------------------------------------------------------</span>
1580 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1581 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsRes), <span class="keyword">return</span>, <span class="keyword">end</span>
1582 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>(marsRes)
1583   fprintf(<span class="string">'Need FMRI design for fitted event time courses\n'</span>);
1584   <span class="keyword">return</span>
1585 <span class="keyword">end</span>
1586 
1587 <span class="comment">% Setup input window</span>
1588 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'Fitted events'</span>, 1);
1589 
1590 [marsRes ic status] = <a href="../marsbar/@mardo/ui_event_types.html" class="code" title="function [D, ic, status] = ui_event_types(D)">ui_event_types</a>(marsRes);
1591 <span class="keyword">if</span> (status==0), <span class="keyword">return</span>, <span class="keyword">end</span>
1592 <span class="keyword">if</span> (status&gt;1), <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, marsRes); <span class="keyword">end</span>
1593 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(ic), <span class="keyword">return</span>, <span class="keyword">end</span>
1594 
1595 dur       = spm_input(<span class="string">'Event duration'</span>, <span class="string">'+1'</span>, <span class="string">'e'</span>, 0);
1596 ic_len    = length(ic);
1597 et = <a href="../marsbar/@mardo/event_types.html" class="code" title="function res = event_types(D, et)">event_types</a>(marsRes);
1598 <span class="keyword">for</span> i = 1:ic_len
1599   [tc{i} dt] = <a href="../marsbar/@mardo/event_fitted.html" class="code" title="function [tc, dt] = event_fitted(D, e_spec, dur)">event_fitted</a>(marsRes, et(ic(i)).e_spec, dur);
1600 <span class="keyword">end</span>
1601 
1602 <span class="keyword">if</span> ic_len &gt; 8
1603   warning(<span class="string">'Too many event types to plot, plotting first 8'</span>);
1604   ic_len = 8;
1605 <span class="keyword">end</span>
1606 
1607 figure(Fgraph);
1608 <span class="keyword">if</span> ic_len &gt; 1, p_cols = 2; <span class="keyword">else</span> p_cols = 1; <span class="keyword">end</span>
1609 p_rows = ceil(ic_len / p_cols);
1610 last_row_starts = (p_rows-1) * p_cols + 1;
1611 <span class="keyword">for</span> i = 1:ic_len
1612   t = tc{i};
1613   secs = ([1:size(t, 1)]-1) * dt;
1614   subplot(p_rows, p_cols, i);
1615   plot(secs, t);
1616   title(et(ic(i)).name);
1617   <span class="keyword">if</span> i &gt;= last_row_starts, xlabel(<span class="string">'Seconds'</span>); <span class="keyword">end</span>
1618   <span class="keyword">if</span> rem(i-1, p_cols)==0, ylabel(<span class="string">'Signal change'</span>); <span class="keyword">end</span>
1619 <span class="keyword">end</span>
1620 
1621 legend(<a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(<a href="../marsbar/@mardo/get_data.html" class="code" title="function d = get_data(D)">get_data</a>(marsRes)));
1622 
1623 assignin(<span class="string">'base'</span>, <span class="string">'time_courses'</span>, tc);
1624 assignin(<span class="string">'base'</span>, <span class="string">'dt'</span>, dt);
1625 
1626 <span class="comment">%=======================================================================</span>
1627 <span class="keyword">case</span> <span class="string">'fir_events'</span>                                  <span class="comment">% show FIR for events</span>
1628 <span class="comment">%=======================================================================</span>
1629 <span class="comment">% marsbar('fir_events')</span>
1630 <span class="comment">%-----------------------------------------------------------------------</span>
1631 marsRes = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1632 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(marsRes), <span class="keyword">return</span>, <span class="keyword">end</span>
1633 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>(marsRes)
1634   fprintf(<span class="string">'Need FMRI design for FIR event time courses\n'</span>);
1635   <span class="keyword">return</span>
1636 <span class="keyword">end</span>
1637 
1638 <span class="comment">% Setup input window</span>
1639 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,<span class="string">'FIR for events'</span>, 1);
1640 
1641 [marsRes ic status] = <a href="../marsbar/@mardo/ui_event_types.html" class="code" title="function [D, ic, status] = ui_event_types(D)">ui_event_types</a>(marsRes);
1642 <span class="keyword">if</span> (status==0), <span class="keyword">return</span>, <span class="keyword">end</span>
1643 <span class="keyword">if</span> (status&gt;1), <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, marsRes); <span class="keyword">end</span>
1644 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(ic), <span class="keyword">return</span>, <span class="keyword">end</span>
1645 
1646 et = <a href="../marsbar/@mardo/event_types.html" class="code" title="function res = event_types(D, et)">event_types</a>(marsRes);
1647 ic_len = length(ic);
1648 
1649 <span class="comment">% Single or stacked?</span>
1650 <span class="comment">% If all the events have zero duration, the model is already single, and</span>
1651 <span class="comment">% there is no point in asking.  If any of the durations are different</span>
1652 <span class="comment">% across events, then the single model is invalid.</span>
1653 d_a = []; opts = []; 
1654 <span class="keyword">for</span> i = 1:ic_len
1655   e_spec = et(ic(i)).e_spec;
1656   <span class="keyword">for</span> j = 1:size(e_spec, 2)
1657     [o d] = <a href="../marsbar/@mardo_2/event_onsets.html" class="code" title="function [onsets, durations] = event_onsets(D, e_spec)">event_onsets</a>(marsRes, e_spec(:, j));
1658     d_a = [d_a; d];
1659   <span class="keyword">end</span>
1660 <span class="keyword">end</span>
1661 <span class="keyword">if</span> any(d_a) &amp;&amp; ~any(diff(d_a))
1662   <span class="keyword">if</span> spm_input(<span class="string">'FIR type'</span>, <span class="string">'+1'</span>,<span class="string">'m'</span>,<span class="keyword">...</span>
1663            <span class="string">'Single|Stacked'</span>, [1 0], 1)
1664     opts.single = 1;
1665   <span class="keyword">end</span>
1666 <span class="keyword">end</span>
1667 <span class="keyword">if</span> spm_input(<span class="string">'Signal units'</span>, <span class="string">'+1'</span>,<span class="string">'m'</span>,<span class="keyword">...</span>
1668          <span class="string">'Percent|Beta units'</span>, [1 0], 1)
1669   opts.percent = 1;
1670 <span class="keyword">end</span>
1671 
1672 bin_length = spm_input(<span class="string">'Bin length (secs)'</span>, <span class="string">'+1'</span>, <span class="string">'e'</span>, <a href="../marsbar/@mardo_2/tr.html" class="code" title="function t = tr(o)">tr</a>(marsRes));
1673 def_bin_no = round(25/bin_length);
1674 bin_no     = spm_input(<span class="string">'No of bins'</span>, <span class="string">'+1'</span>, <span class="string">'e'</span>, def_bin_no);
1675 
1676 <span class="keyword">for</span> i = 1:ic_len
1677   tc{i} = <a href="../marsbar/@mardo/event_fitted_fir.html" class="code" title="function [tc, dt] = event_fitted_fir(D, e_spec, bin_length, bin_no, opts)">event_fitted_fir</a>(marsRes, <span class="keyword">...</span>
1678                et(ic(i)).e_spec, <span class="keyword">...</span>
1679                bin_length, <span class="keyword">...</span>
1680                bin_no, <span class="keyword">...</span>
1681                opts);
1682 <span class="keyword">end</span>
1683 
1684 <span class="keyword">if</span> ic_len &gt; 8
1685   warning(<span class="string">'Too many event types to plot, plotting first 8'</span>);
1686   ic_len = 8;
1687 <span class="keyword">end</span>
1688 
1689 figure(Fgraph);
1690 <span class="keyword">if</span> ic_len &gt; 1, p_cols = 2; <span class="keyword">else</span> p_cols = 1; <span class="keyword">end</span>
1691 p_rows = ceil(ic_len / p_cols);
1692 last_row_starts = (p_rows-1) * p_cols + 1;
1693 secs = ([1:bin_no]-1) * bin_length + bin_length/2;
1694 <span class="keyword">for</span> i = 1:ic_len
1695   t = tc{i};
1696   subplot(p_rows, p_cols, i);
1697   plot(secs, t);
1698   title(et(ic(i)).name);
1699   <span class="keyword">if</span> i &gt;= last_row_starts, xlabel(<span class="string">'Seconds'</span>); <span class="keyword">end</span>
1700   <span class="keyword">if</span> rem(i-1, p_cols)==0, ylabel(<span class="string">'Signal change'</span>); <span class="keyword">end</span>
1701 <span class="keyword">end</span>
1702 legend(<a href="../marsbar/@marsy/region_name.html" class="code" title="function res = region_name(o, r_nos, new_data, default_prefix)">region_name</a>(<a href="../marsbar/@mardo/get_data.html" class="code" title="function d = get_data(D)">get_data</a>(marsRes)));
1703 
1704 assignin(<span class="string">'base'</span>, <span class="string">'time_courses'</span>, tc);
1705 assignin(<span class="string">'base'</span>, <span class="string">'bin_length'</span>, bin_length);
1706 assignin(<span class="string">'base'</span>, <span class="string">'bin_no'</span>, bin_no);
1707 
1708 <span class="comment">%=======================================================================</span>
1709 <span class="keyword">case</span> <span class="string">'add_events_by_name'</span>  <span class="comment">%-make event types from events with same name</span>
1710 <span class="comment">%=======================================================================</span>
1711 <span class="comment">% marsbar(''add_events_by_name')</span>
1712 <span class="comment">%-----------------------------------------------------------------------</span>
1713 D = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1714 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(D), <span class="keyword">return</span>, <span class="keyword">end</span>
1715 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>(D)
1716   disp(<span class="string">'Can only add event types to FMRI designs'</span>);
1717   <span class="keyword">return</span>
1718 <span class="keyword">end</span>
1719 et = <a href="../marsbar/@mardo/event_types.html" class="code" title="function res = event_types(D, et)">event_types</a>(D);
1720 et = [et <a href="../marsbar/@mardo/event_types_named.html" class="code" title="function et = event_types_named(D)">event_types_named</a>(D)];
1721 D  = <a href="../marsbar/@mardo/event_types.html" class="code" title="function res = event_types(D, et)">event_types</a>(D, et);
1722 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, D);
1723  
1724 <span class="comment">%=======================================================================</span>
1725 <span class="keyword">case</span> <span class="string">'merge_contrasts'</span>                                <span class="comment">%-import contrasts</span>
1726 <span class="comment">%=======================================================================</span>
1727 <span class="comment">% marsbar('merge_contrasts')</span>
1728 <span class="comment">%-----------------------------------------------------------------------</span>
1729 D = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1730 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(D), <span class="keyword">return</span>, <span class="keyword">end</span>
1731 filter_spec = {<span class="keyword">...</span>
1732     <span class="string">'SPM.mat'</span>,<span class="string">'SPM: SPM.mat'</span>;<span class="keyword">...</span>
1733     <span class="string">'*_mres.mat'</span>,<span class="string">'MarsBaR: *_mres.mat'</span>;<span class="keyword">...</span>
1734     <span class="string">'*x?on.mat'</span>,<span class="string">'xCon.mat file'</span>};
1735 [fn pn] = <a href="mars_uifile.html" class="code" title="function [fn,pn,fi] = mars_uifile(action, filter_spec, prompt, filename, varargin)">mars_uifile</a>(<span class="string">'get'</span>, <span class="keyword">...</span>
1736     filter_spec, <span class="keyword">...</span>
1737     <span class="string">'Source design/contrast file...'</span>);
1738 <span class="keyword">if</span> isequal(fn,0) || isequal(pn,0), <span class="keyword">return</span>, <span class="keyword">end</span>
1739 fname = fullfile(pn, fn);
1740 D2 = <a href="../marsbar/@mardo/mardo.html" class="code" title="function [o, others] = mardo(params, others, passf)">mardo</a>(fname);
1741 
1742 <span class="comment">% has this got contrasts?</span>
1743 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/has_contrasts.html" class="code" title="function tf = has_contrasts(D)">has_contrasts</a>(D2)
1744   error([<span class="string">'Cannot find contrasts in design/contrast file '</span> fname]);
1745 <span class="keyword">end</span>
1746   
1747 <span class="comment">% now try to trap case of contrast only file</span>
1748 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_valid.html" class="code" title="function tf = is_valid(o)">is_valid</a>(D2)
1749   D2 = <a href="../marsbar/@mardo/get_contrasts.html" class="code" title="function xCon = get_contrasts(D)">get_contrasts</a>(D2);
1750 <span class="keyword">end</span>
1751 
1752 [D Ic changef] = <a href="../marsbar/@mardo/add_contrasts.html" class="code" title="function [D,Ic,changef] = add_contrasts(D, C, varargin)">add_contrasts</a>(D, D2, <span class="string">'ui'</span>);
1753 disp(<span class="string">'Done'</span>);
1754 <span class="keyword">if</span> changef
1755   <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, D);
1756 <span class="keyword">end</span>
1757 
1758 <span class="comment">%=======================================================================</span>
1759 <span class="keyword">case</span> <span class="string">'refresh_contrasts'</span>                             <span class="comment">%-refresh contrasts</span>
1760 <span class="comment">%=======================================================================</span>
1761 <span class="comment">% marsbar('refresh_contrasts')</span>
1762 <span class="comment">%-----------------------------------------------------------------------</span>
1763 D = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1764 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(D), <span class="keyword">return</span>, <span class="keyword">end</span>
1765 D = <a href="../marsbar/@mardo/refresh_contrasts.html" class="code" title="function o = refresh_contrasts(o)">refresh_contrasts</a>(D);
1766 disp(<span class="string">'Refreshed contrasts'</span>);
1767 <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, D);
1768 
1769 <span class="comment">%=======================================================================</span>
1770 <span class="keyword">case</span> <span class="string">'add_trial_f'</span>            <span class="comment">%-add trial-specific F contrasts to design</span>
1771 <span class="comment">%=======================================================================</span>
1772 <span class="comment">% marsbar('add_trial_f')</span>
1773 <span class="comment">%-----------------------------------------------------------------------</span>
1774 D = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'get'</span>, <span class="string">'est_design'</span>);
1775 <span class="keyword">if</span> <a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(D), <span class="keyword">return</span>, <span class="keyword">end</span>
1776 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/is_fmri.html" class="code" title="function tf = is_fmri(D)">is_fmri</a>(D)
1777   disp(<span class="string">'Can only add trial specific F contrasts for FMRI designs'</span>);
1778   <span class="keyword">return</span>
1779 <span class="keyword">end</span>
1780 [D changef] = <a href="../marsbar/@mardo_2/add_trial_f.html" class="code" title="function [D, changef] = add_trial_f(D)">add_trial_f</a>(D);
1781 disp(<span class="string">'Done'</span>);
1782 <span class="keyword">if</span> changef
1783   <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'update'</span>, <span class="string">'est_design'</span>, D);
1784 <span class="keyword">end</span>
1785  
1786 <span class="comment">%=======================================================================</span>
1787 <span class="keyword">case</span> <span class="string">'error_log'</span>                  <span class="comment">%- makes file to help debugging errors</span>
1788 <span class="comment">%=======================================================================</span>
1789 <span class="comment">% fname = marsbar('error_log', fname);</span>
1790 <span class="comment">%-----------------------------------------------------------------------</span>
1791 <span class="keyword">if</span> nargin &lt; 2
1792   fname = <span class="string">'error_log.mat'</span>;
1793 <span class="keyword">else</span>
1794   fname = varargin{2};
1795 <span class="keyword">end</span>
1796 
1797 e_log = struct(<span class="string">'last_error'</span>, lasterr, <span class="keyword">...</span>
1798            <span class="string">'m_ver'</span>, <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(<span class="string">'ver'</span>),<span class="keyword">...</span>
1799            <span class="string">'mars'</span>, MARS);
1800 <a href="savestruct.html" class="code" title="function savestruct(varargin)">savestruct</a>(fname, e_log);
1801 <span class="keyword">if</span> ~<a href="../marsbar/@mardo/isempty.html" class="code" title="function tf = isempty(o)">isempty</a>(which(<span class="string">'zip'</span>))
1802   zip([fname <span class="string">'.zip'</span>], fname);
1803   fname = [fname <span class="string">'.zip'</span>];
1804 <span class="keyword">end</span>
1805 disp([<span class="string">'Saved error log as '</span> fname]);
1806 
1807 <span class="comment">%=======================================================================</span>
1808 <span class="keyword">case</span> <span class="string">'mars_menu'</span>                     <span class="comment">%-menu selection of marsbar actions</span>
1809 <span class="comment">%=======================================================================</span>
1810 <span class="comment">% marsbar('mars_menu',tstr,pstr,tasks_str,tasks)</span>
1811 <span class="comment">%-----------------------------------------------------------------------</span>
1812 
1813 [tstr pstr optfields optlabs] = deal(varargin{2:5}); 
1814 <span class="keyword">if</span> nargin &lt; 6
1815   optargs = cell(1, length(optfields));
1816 <span class="keyword">else</span>
1817   optargs = varargin{6};
1818 <span class="keyword">end</span>
1819 
1820 [Finter,Fgraph,CmdLine] = spm(<span class="string">'FnUIsetup'</span>,tstr);
1821 of_end = length(optfields)+1;
1822 my_task = spm_input(pstr, <span class="string">'+1'</span>, <span class="string">'m'</span>,<span class="keyword">...</span>
1823           {optlabs{:} <span class="string">'Quit'</span>},<span class="keyword">...</span>
1824           [1:of_end],of_end);
1825 <span class="keyword">if</span> my_task == of_end, <span class="keyword">return</span>, <span class="keyword">end</span>
1826 <a href="marsbar.html" class="code" title="function varargout=marsbar(varargin)">marsbar</a>(optfields{my_task}{:});
1827 
1828 <span class="comment">%=======================================================================</span>
1829 <span class="keyword">otherwise</span>                                        <span class="comment">%-Unknown action string</span>
1830 <span class="comment">%=======================================================================</span>
1831 error(<span class="string">'Unknown action string'</span>)
1832 
1833 <span class="comment">%=======================================================================</span>
1834 <span class="keyword">end</span>
1835 <span class="keyword">return</span>
1836 
1837 <span class="comment">% subfunctions</span>
1838 <a name="_sub1" href="#_subfunctions" class="code">function sum_func = sf_get_sumfunc(sum_func)</a>
1839 <span class="keyword">if</span> strcmp(sum_func, <span class="string">'ask'</span>)
1840   sum_func = char(spm_input(<span class="string">'Summary function'</span>, <span class="string">'+1'</span>,<span class="string">'m'</span>,<span class="keyword">...</span>
1841                <span class="string">'Mean|Weighted mean|Median|1st eigenvector'</span>,<span class="keyword">...</span>
1842                {<span class="string">'mean'</span>,<span class="string">'wtmean'</span>,<span class="string">'median'</span>,<span class="string">'eigen1'</span>}, 1));
1843 <span class="keyword">end</span>
1844 
1845 <a name="_sub2" href="#_subfunctions" class="code">function btn = sf_prev_save(obj_name)</a>
1846 btn = <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'save_ui'</span>, obj_name, <span class="keyword">...</span>
1847            struct(<span class="string">'ync'</span>, 1, <span class="keyword">...</span>
1848               <span class="string">'no_no_save'</span>, 1, <span class="keyword">...</span>
1849               <span class="string">'prompt_prefix'</span>, <span class="string">'previous '</span>));
1850 <span class="comment">% If answer is 'No', then flag that we don't need to save</span>
1851 <span class="keyword">if</span> btn == 0
1852   <a href="mars_arm.html" class="code" title="function varargout = mars_arm(action, varargin)">mars_arm</a>(<span class="string">'set_param'</span>, obj_name, <span class="string">'has_changed'</span>, 0);
1853 <span class="keyword">end</span>
1854 <span class="keyword">return</span>
1855 
</pre></div>

<hr><address>Generated on Wed 11-May-2022 15:34:44 by <strong><a href="https://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003-2019</address>
</body>
</html>
