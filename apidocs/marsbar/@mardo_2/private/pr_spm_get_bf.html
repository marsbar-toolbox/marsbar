<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of pr_spm_get_bf</title>
  <meta name="keywords" content="pr_spm_get_bf">
  <meta name="description" content="fills in basis function structure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">marsbar</a> &gt; <a href="../index.html">@mardo_2</a> &gt; <a href="index.html">private</a> &gt; pr_spm_get_bf.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for marsbar/@mardo_2/private&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>pr_spm_get_bf
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>fills in basis function structure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [xBF] = pr_spm_get_bf(xBF) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> fills in basis function structure
 FORMAT [xBF] = spm_get_bf(xBF);

 xBF.dt      - time bin length {seconds}
 xBF.name    - description of basis functions specified
 xBF.length  - window length (secs)
 xBF.order   - order
 xBF.bf      - Matrix of basis functions

 xBF.name    'hrf'
        'hrf (with time derivative)'
        'hrf (with time and dispersion derivatives)'
        'Fourier set'
        'Fourier set (Hanning)'
        'Gamma functions'
        'Finite Impulse Response'};

 (any other specifiaction will default to hrf)
_______________________________________________________________________

 spm_get_bf prompts for basis functions to model event or epoch-related
 responses.  The basis functions returned are unitary and orthonormal
 when defined as a function of peri-stimulus time in time-bins.
 It is at this point that the distinction between event and epoch-related 
 responses enters.
_______________________________________________________________________
 @(#)spm_get_bf.m    2.22  Karl Friston 02/04/19
</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../marsbar/@mardo/isfield.html" class="code" title="function result = isfield(this, fieldn)">isfield</a>	method to overload isfield for mardo objects</li>
<li><a href="pr_spm_gpdf.html" class="code" title="function f = spm_Gpdf(x,h,l)">pr_spm_gpdf</a>	Probability Density Function (PDF) of Gamma distribution</li>
<li><a href="pr_spm_hrf.html" class="code" title="function [hrf,p] = pr_spm_hrf(RT,P);">pr_spm_hrf</a>	returns a hemodynamic response function</li>
<li><a href="pr_spm_orth.html" class="code" title="function x = spm_orth(X)">pr_spm_orth</a>	recursive orthogonalization of basis functions</li>
<li><a href="../../../marsbar/@mardo_5/private/pr_spm_gpdf.html" class="code" title="function f = pr_spm_gpdf(x,h,l)">pr_spm_gpdf</a>	Probability Density Function (PDF) of Gamma distribution</li>
<li><a href="../../../marsbar/@mardo_5/private/pr_spm_hrf.html" class="code" title="function [hrf,p] = pr_spm_hrf(RT,P);">pr_spm_hrf</a>	returns a hemodynamic response function</li>
<li><a href="../../../marsbar/@mardo_5/private/pr_spm_orth.html" class="code" title="function x = pr_spm_orth(X)">pr_spm_orth</a>	recursive orthogonalization of basis functions</li>
<li><a href="../../../marsbar/@mardo_99/private/pr_spm_hrf.html" class="code" title="function [hrf,p] = pr_spm_hrf(RT,P);">pr_spm_hrf</a>	returns a hemodynamic response function</li>
<li><a href="../../../marsbar/@mardo_99/private/pr_spm_orth.html" class="code" title="function bf = pr_spm_orth(BF)">pr_spm_orth</a>	recursive orthogonalization of basis functions</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../marsbar/@mardo_2/event_x_fir.html" class="code" title="function Xn = event_x_fir(D, e_spec, bin_length, bin_no, opts)">event_x_fir</a>	method to return FIR design matrix columns for session</li>
<li><a href="../../../marsbar/@mardo_2/mars_spm_graph.html" class="code" title="function [r_st,marsD,changef] = mars_spm_graph(marsD,rno,Ic)">mars_spm_graph</a>	Graphical display of adjusted data</li>
<li><a href="pr_fmri_design.html" class="code" title="function [SPM] = pr_fmri_design(SPM)">pr_fmri_design</a>	MarsBaR version of spm_fMRI design - asssembles a design for fMRI studies</li>
<li><a href="../../../marsbar/@mardo_5/private/pr_fmri_design.html" class="code" title="function [SPM] = pr_fmri_design(SPM)">pr_fmri_design</a>	MarsBaR version of spm_fMRI design - asssembles a design for fMRI studies</li>
<li><a href="../../../marsbar/@mardo_99/private/pr_fmri_design.html" class="code" title="function [SPM] = pr_fmri_design(SPM)">pr_fmri_design</a>	MarsBaR version of spm_fMRI design - asssembles a design for fMRI studies</li>
<li><a href="../../../marsbar/@mardo_99/private/pr_spm_get_bf.html" class="code" title="function [BF,BFstr] = pr_spm_get_bf(name,T,dt,Fstr,n_s,n_c)">pr_spm_get_bf</a>	creates basis functions for each trial type {i} in struct BF{i}</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function bf = spm_gamma_bf(u,h)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [xBF] = pr_spm_get_bf(xBF)</a>
0002 <span class="comment">% fills in basis function structure</span>
0003 <span class="comment">% FORMAT [xBF] = spm_get_bf(xBF);</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% xBF.dt      - time bin length {seconds}</span>
0006 <span class="comment">% xBF.name    - description of basis functions specified</span>
0007 <span class="comment">% xBF.length  - window length (secs)</span>
0008 <span class="comment">% xBF.order   - order</span>
0009 <span class="comment">% xBF.bf      - Matrix of basis functions</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% xBF.name    'hrf'</span>
0012 <span class="comment">%        'hrf (with time derivative)'</span>
0013 <span class="comment">%        'hrf (with time and dispersion derivatives)'</span>
0014 <span class="comment">%        'Fourier set'</span>
0015 <span class="comment">%        'Fourier set (Hanning)'</span>
0016 <span class="comment">%        'Gamma functions'</span>
0017 <span class="comment">%        'Finite Impulse Response'};</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% (any other specifiaction will default to hrf)</span>
0020 <span class="comment">%_______________________________________________________________________</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% spm_get_bf prompts for basis functions to model event or epoch-related</span>
0023 <span class="comment">% responses.  The basis functions returned are unitary and orthonormal</span>
0024 <span class="comment">% when defined as a function of peri-stimulus time in time-bins.</span>
0025 <span class="comment">% It is at this point that the distinction between event and epoch-related</span>
0026 <span class="comment">% responses enters.</span>
0027 <span class="comment">%_______________________________________________________________________</span>
0028 <span class="comment">% @(#)spm_get_bf.m    2.22  Karl Friston 02/04/19</span>
0029 
0030 <span class="comment">%-GUI setup</span>
0031 <span class="comment">%-----------------------------------------------------------------------</span>
0032 spm_help(<span class="string">'!ContextHelp'</span>,mfilename)
0033 
0034 <span class="comment">% length of time bin</span>
0035 <span class="comment">%-----------------------------------------------------------------------</span>
0036 <span class="keyword">if</span> ~nargin
0037     str    = <span class="string">'time bin for basis functions {secs}'</span>;
0038     xBF.dt = spm_input(str,<span class="string">'+1'</span>,<span class="string">'r'</span>,1/16,1);
0039 <span class="keyword">end</span>
0040 dt   = xBF.dt;
0041 
0042 
0043 <span class="comment">% assemble basis functions</span>
0044 <span class="comment">%=======================================================================</span>
0045 
0046 <span class="comment">% model event-related responses</span>
0047 <span class="comment">%-----------------------------------------------------------------------</span>
0048 <span class="keyword">if</span> ~<a href="../../../marsbar/@mardo/isfield.html" class="code" title="function result = isfield(this, fieldn)">isfield</a>(xBF,<span class="string">'name'</span>)
0049     spm_input(<span class="string">'Hemodynamic Basis functions...'</span>,1,<span class="string">'d'</span>)
0050     Ctype = {
0051         <span class="string">'hrf'</span>,<span class="keyword">...</span>
0052         <span class="string">'hrf (with time derivative)'</span>,<span class="keyword">...</span>
0053         <span class="string">'hrf (with time and dispersion derivatives)'</span>,<span class="keyword">...</span>
0054         <span class="string">'Fourier set'</span>,<span class="keyword">...</span>
0055         <span class="string">'Fourier set (Hanning)'</span>,<span class="keyword">...</span>
0056         <span class="string">'Gamma functions'</span>,<span class="keyword">...</span>
0057         <span class="string">'Finite Impulse Response'</span>};
0058     str   = <span class="string">'Select basis set'</span>;
0059     Sel   = spm_input(str,2,<span class="string">'m'</span>,Ctype);
0060     xBF.name = Ctype{Sel};
0061 <span class="keyword">end</span>
0062 
0063 <span class="comment">% get order and length parameters</span>
0064 <span class="comment">%-----------------------------------------------------------------------</span>
0065 <span class="keyword">switch</span> xBF.name
0066 
0067     <span class="keyword">case</span> {    <span class="string">'Fourier set'</span>,<span class="string">'Fourier set (Hanning)'</span>,<span class="keyword">...</span>
0068         <span class="string">'Gamma functions'</span>,<span class="string">'Finite Impulse Response'</span>}
0069     <span class="comment">%---------------------------------------------------------------</span>
0070     <span class="keyword">try</span>,    l          = xBF.length;
0071     <span class="keyword">catch</span>,    l          = spm_input(<span class="string">'window length {secs}'</span>,3,<span class="string">'e'</span>,32);
0072         xBF.length = l;
0073     <span class="keyword">end</span>
0074     <span class="keyword">try</span>,    h          = xBF.order;
0075     <span class="keyword">catch</span>,    h          = spm_input(<span class="string">'order'</span>,4,<span class="string">'e'</span>,4);
0076         xBF.order  = h;
0077     <span class="keyword">end</span>
0078 <span class="keyword">end</span>
0079 
0080 
0081 
0082 <span class="comment">% create basis functions</span>
0083 <span class="comment">%-----------------------------------------------------------------------</span>
0084 <span class="keyword">switch</span> xBF.name
0085 
0086     <span class="keyword">case</span> {<span class="string">'Fourier set'</span>,<span class="string">'Fourier set (Hanning)'</span>}
0087     <span class="comment">%---------------------------------------------------------------</span>
0088     pst   = [0:dt:l]';
0089     pst   = pst/max(pst);
0090 
0091     <span class="comment">% hanning window</span>
0092     <span class="comment">%---------------------------------------------------------------</span>
0093     <span class="keyword">if</span> strcmp(xBF.name,<span class="string">'Fourier set (Hanning)'</span>)
0094         g  = (1 - cos(2*pi*pst))/2;
0095     <span class="keyword">else</span>
0096         g  = ones(size(pst));
0097     <span class="keyword">end</span>
0098 
0099     <span class="comment">% zeroth and higher Fourier terms</span>
0100     <span class="comment">%---------------------------------------------------------------</span>
0101     bf    = g;
0102     <span class="keyword">for</span> i = 1:h
0103         bf = [bf g.*sin(i*2*pi*pst)];
0104         bf = [bf g.*cos(i*2*pi*pst)];    
0105     <span class="keyword">end</span>
0106 
0107     <span class="keyword">case</span> {<span class="string">'Gamma functions'</span>}
0108     <span class="comment">%---------------------------------------------------------------</span>
0109     pst   = [0:dt:l]';
0110     bf    = <a href="#_sub1" class="code" title="subfunction bf = spm_gamma_bf(u,h)">spm_gamma_bf</a>(pst,h);
0111 
0112     <span class="keyword">case</span> {<span class="string">'Finite Impulse Response'</span>}
0113     <span class="comment">%---------------------------------------------------------------</span>
0114     bin   = l/h;
0115     bf    = kron(eye(h),ones(round(bin/dt),1));
0116 
0117     <span class="keyword">case</span> {<span class="string">'NONE'</span>} <span class="comment">% innovation from SPM5</span>
0118     <span class="comment">%---------------------------------------------------------------</span>
0119     bf = 1;
0120 
0121 <span class="keyword">otherwise</span>
0122 
0123     <span class="comment">% canonical hemodynaic response function</span>
0124     <span class="comment">%---------------------------------------------------------------</span>
0125     [bf p]         = <a href="pr_spm_hrf.html" class="code" title="function [hrf,p] = pr_spm_hrf(RT,P);">pr_spm_hrf</a>(dt);
0126 
0127     <span class="comment">% add time derivative</span>
0128     <span class="comment">%---------------------------------------------------------------</span>
0129     <span class="keyword">if</span> findstr(xBF.name,<span class="string">'time'</span>)
0130 
0131         dp     = 1;
0132         p(6)   = p(6) + dp;
0133         D      = (bf(:,1) - <a href="pr_spm_hrf.html" class="code" title="function [hrf,p] = pr_spm_hrf(RT,P);">pr_spm_hrf</a>(dt,p))/dp;
0134         bf     = [bf D(:)];
0135         p(6)   = p(6) - dp;
0136 
0137         <span class="comment">% add dispersion derivative</span>
0138         <span class="comment">%--------------------------------------------------------</span>
0139         <span class="keyword">if</span> findstr(xBF.name,<span class="string">'dispersion'</span>)
0140 
0141             dp    = 0.01;
0142             p(3)  = p(3) + dp;
0143             D     = (bf(:,1) - <a href="pr_spm_hrf.html" class="code" title="function [hrf,p] = pr_spm_hrf(RT,P);">pr_spm_hrf</a>(dt,p))/dp;
0144             bf    = [bf D(:)];
0145         <span class="keyword">end</span>
0146     <span class="keyword">end</span>
0147 
0148     <span class="comment">% length and order</span>
0149     <span class="comment">%---------------------------------------------------------------</span>
0150     xBF.length = size(bf,1)*dt;
0151     xBF.order  = size(bf,2);
0152 
0153 <span class="keyword">end</span>
0154 
0155 
0156 <span class="comment">% Orthogonalize and fill in basis function structure</span>
0157 <span class="comment">%------------------------------------------------------------------------</span>
0158 xBF.bf  =  <a href="pr_spm_orth.html" class="code" title="function x = spm_orth(X)">pr_spm_orth</a>(bf);
0159 
0160 
0161 <span class="comment">%=======================================================================</span>
0162 <span class="comment">%- S U B - F U N C T I O N S</span>
0163 <span class="comment">%=======================================================================</span>
0164 
0165 <span class="comment">% compute Gamma functions functions</span>
0166 <span class="comment">%-----------------------------------------------------------------------</span>
0167 <a name="_sub1" href="#_subfunctions" class="code">function bf = spm_gamma_bf(u,h)</a>
0168 <span class="comment">% returns basis functions used for Volterra expansion</span>
0169 <span class="comment">% FORMAT bf = spm_gamma_bf(u,h);</span>
0170 <span class="comment">% u   - times {seconds}</span>
0171 <span class="comment">% h   - order</span>
0172 <span class="comment">% bf  - basis functions (mixture of Gammas)</span>
0173 <span class="comment">%_______________________________________________________________________</span>
0174 u     = u(:);
0175 bf    = [];
0176 <span class="keyword">for</span> i = 2:(1 + h)
0177         m   = 2^i;
0178         s   = sqrt(m);
0179         bf  = [bf <a href="pr_spm_gpdf.html" class="code" title="function f = spm_Gpdf(x,h,l)">pr_spm_gpdf</a>(u,(m/s)^2,m/s^2)];
0180 <span class="keyword">end</span>
</pre></div>

<hr><address>Generated on Wed 11-May-2022 15:34:44 by <strong><a href="https://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003-2019</address>
</body>
</html>
